"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.runBrowser = runBrowser;
const tslib_1 = require("tslib");
const architect_1 = require("@angular-devkit/architect");
const build_angular_1 = require("@angular-devkit/build-angular");
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const build_ng_doc_1 = require("../engine/build-ng-doc");
const helpers_1 = require("../helpers");
/**
 * Attach NgDocWebpackPlugin before Angular Plugins
 * @param options Builder configuration
 * @param context Builder context
 * @returns Observable of BrowserBuilderOutput
 */
function runBrowser(options, context) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        var _a;
        const browserTarget = options.buildTarget
            ? (0, architect_1.targetFromTargetString)(options.buildTarget)
            : null;
        const targetOptions = browserTarget
            ? yield context.getTargetOptions(browserTarget)
            : options;
        const builderContext = (0, helpers_1.createBuilderContext)(targetOptions, context, (_a = options.ngDoc) === null || _a === void 0 ? void 0 : _a.config);
        const runner = (0, build_ng_doc_1.buildNgDoc)(builderContext);
        yield (0, rxjs_1.firstValueFrom)(runner.pipe((0, operators_1.first)()));
        return (0, rxjs_1.firstValueFrom)((0, architect_1.fromAsyncIterable)((0, build_angular_1.buildApplication)(options, context)));
    });
}
// eslint-disable-next-line @typescript-eslint/ban-ts-comment
// @ts-ignore
exports.default = (0, architect_1.createBuilder)(runBrowser);
//# sourceMappingURL=index.js.map