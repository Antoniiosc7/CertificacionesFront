import { Overlay, } from '@angular/cdk/overlay';
import { ComponentPortal } from '@angular/cdk/portal';
import { Injectable, Injector, NgZone, Optional, } from '@angular/core';
import { Router } from '@angular/router';
import { asArray } from '@ng-doc/core/helpers/as-array';
import { NgDocOverlayRef } from '@ng-doc/ui-kit/classes';
import { NgDocOverlayUtils } from '@ng-doc/ui-kit/utils';
import { PolymorpheusComponent } from '@tinkoff/ng-polymorpheus';
import { take } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/overlay";
import * as i2 from "@angular/router";
export class NgDocOverlayService {
    constructor(overlay, ngZone, injector, router) {
        this.overlay = overlay;
        this.ngZone = ngZone;
        this.injector = injector;
        this.router = router;
    }
    open(content, config, providers = []) {
        const overlayRef = this.createOverlay(config);
        return this.attachTooltipContainer(content, overlayRef, config, providers);
    }
    attachTooltipContainer(content, overlay, config, providers) {
        const containerPortal = new ComponentPortal(config.overlayContainer, config.viewContainerRef, config.viewContainerRef?.injector);
        const containerRef = overlay.attach(containerPortal);
        const overlayRef = new NgDocOverlayRef(overlay, config, containerRef.instance, this.ngZone, this.router);
        if (content instanceof PolymorpheusComponent) {
            content = new PolymorpheusComponent(content.component, this.createInjector(overlayRef, providers, config.viewContainerRef?.injector));
        }
        containerRef.instance.config = config;
        containerRef.instance.content = content;
        containerRef.instance.markForCheck();
        return overlayRef;
    }
    createOverlay(config) {
        const overlayRef = this.overlay.create(config);
        overlayRef
            .detachments()
            .pipe(take(1))
            .subscribe(() => {
            overlayRef.hasAttached() && overlayRef.detach();
        });
        return overlayRef;
    }
    connectedPositionStrategy(origin, positions) {
        return this.overlay
            .position()
            .flexibleConnectedTo(origin)
            .withPositions(NgDocOverlayUtils.toConnectedPositions(asArray(positions)))
            .withPush(true);
    }
    globalPositionStrategy() {
        return this.overlay.position().global();
    }
    scrollStrategy() {
        return this.overlay.scrollStrategies;
    }
    createInjector(overlayRef, providers, injector) {
        return Injector.create({
            providers: [
                ...providers,
                {
                    provide: NgDocOverlayRef,
                    useValue: overlayRef,
                },
            ],
            parent: injector || this.injector,
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: NgDocOverlayService, deps: [{ token: i1.Overlay }, { token: i0.NgZone }, { token: i0.Injector }, { token: i2.Router, optional: true }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: NgDocOverlayService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: NgDocOverlayService, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }], ctorParameters: () => [{ type: i1.Overlay }, { type: i0.NgZone }, { type: i0.Injector }, { type: i2.Router, decorators: [{
                    type: Optional
                }] }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3ZlcmxheS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy91aS1raXQvc2VydmljZXMvb3ZlcmxheS9vdmVybGF5LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUdOLE9BQU8sR0FHUCxNQUFNLHNCQUFzQixDQUFDO0FBQzlCLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBRU4sVUFBVSxFQUNWLFFBQVEsRUFDUixNQUFNLEVBQ04sUUFBUSxHQUVSLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBR3pELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7OztBQUd0QyxNQUFNLE9BQU8sbUJBQW1CO0lBQy9CLFlBQ1MsT0FBZ0IsRUFDaEIsTUFBYyxFQUNkLFFBQWtCLEVBRWxCLE1BQWU7UUFKZixZQUFPLEdBQVAsT0FBTyxDQUFTO1FBQ2hCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBRWxCLFdBQU0sR0FBTixNQUFNLENBQVM7SUFDckIsQ0FBQztJQUVKLElBQUksQ0FDSCxPQUFxQixFQUNyQixNQUEwQixFQUMxQixZQUE4QixFQUFFO1FBRWhDLE1BQU0sVUFBVSxHQUFlLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUQsT0FBTyxJQUFJLENBQUMsc0JBQXNC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bGV4aWJsZUNvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3ksXG5cdEdsb2JhbFBvc2l0aW9uU3RyYXRlZ3ksXG5cdE92ZXJsYXksXG5cdE92ZXJsYXlSZWYsXG5cdFNjcm9sbFN0cmF0ZWd5T3B0aW9ucyxcbn0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuaW1wb3J0IHsgQ29tcG9uZW50UG9ydGFsIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3BvcnRhbCc7XG5pbXBvcnQge1xuXHRDb21wb25lbnRSZWYsXG5cdEluamVjdGFibGUsXG5cdEluamVjdG9yLFxuXHROZ1pvbmUsXG5cdE9wdGlvbmFsLFxuXHRTdGF0aWNQcm92aWRlcixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgYXNBcnJheSB9IGZyb20gJ0BuZy1kb2MvY29yZS9oZWxwZXJzL2FzLWFycmF5JztcbmltcG9ydCB7IE5nRG9jT3ZlcmxheVJlZiB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L2NsYXNzZXMnO1xuaW1wb3J0IHsgTmdEb2NPdmVybGF5Q29uZmlnLCBOZ0RvY092ZXJsYXlDb250YWluZXIgfSBmcm9tICdAbmctZG9jL3VpLWtpdC9pbnRlcmZhY2VzJztcbmltcG9ydCB7IE5nRG9jQ29udGVudCwgTmdEb2NPdmVybGF5T3JpZ2luLCBOZ0RvY092ZXJsYXlQb3NpdGlvbiB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L3R5cGVzJztcbmltcG9ydCB7IE5nRG9jT3ZlcmxheVV0aWxzIH0gZnJvbSAnQG5nLWRvYy91aS1raXQvdXRpbHMnO1xuaW1wb3J0IHsgUG9seW1vcnBoZXVzQ29tcG9uZW50IH0gZnJvbSAnQHRpbmtvZmYvbmctcG9seW1vcnBoZXVzJztcbmltcG9ydCB7IHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5leHBvcnQgY2xhc3MgTmdEb2NPdmVybGF5U2VydmljZSB7XG5cdGNvbnN0cnVjdG9yKFxuXHRcdHByaXZhdGUgb3ZlcmxheTogT3ZlcmxheSxcblx0XHRwcml2YXRlIG5nWm9uZTogTmdab25lLFxuXHRcdHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxuXHRcdEBPcHRpb25hbCgpXG5cdFx0cHJpdmF0ZSByb3V0ZXI/OiBSb3V0ZXIsXG5cdCkge31cblxuXHRvcGVuPFI+KFxuXHRcdGNvbnRlbnQ6IE5nRG9jQ29udGVudCxcblx0XHRjb25maWc6IE5nRG9jT3ZlcmxheUNvbmZpZyxcblx0XHRwcm92aWRlcnM6IFN0YXRpY1Byb3ZpZGVyW10gPSBbXSxcblx0KTogTmdEb2NPdmVybGF5UmVmPFI+IHtcblx0XHRjb25zdCBvdmVybGF5UmVmOiBPdmVybGF5UmVmID0gdGhpcy5jcmVhdGVPdmVybGF5KGNvbmZpZyk7XG5cdFx0cmV0dXJuIHRoaXMuYXR0YWNoVG9vbHRpcENvbnRhaW5lcihjb250ZW50LCBvdmVybGF5UmVmLCBjb25maWcsIHByb3ZpZGVycyk7XG5cdH1cblxuXHRwcml2YXRlIGF0dGFjaFRvb2x0aXBDb250YWluZXI8Uj4oXG5cdFx0Y29udGVudDogTmdEb2NDb250ZW50LFxuXHRcdG92ZXJsYXk6IE92ZXJsYXlSZWYsXG5cdFx0Y29uZmlnOiBOZ0RvY092ZXJsYXlDb25maWcsXG5cdFx0cHJvdmlkZXJzOiBTdGF0aWNQcm92aWRlcltdLFxuXHQpOiBOZ0RvY092ZXJsYXlSZWY8Uj4ge1xuXHRcdGNvbnN0IGNvbnRhaW5lclBvcnRhbDogQ29tcG9uZW50UG9ydGFsPE5nRG9jT3ZlcmxheUNvbnRhaW5lcj4gPSBuZXcgQ29tcG9uZW50UG9ydGFsKFxuXHRcdFx0Y29uZmlnLm92ZXJsYXlDb250YWluZXIsXG5cdFx0XHRjb25maWcudmlld0NvbnRhaW5lclJlZixcblx0XHRcdGNvbmZpZy52aWV3Q29udGFpbmVyUmVmPy5pbmplY3Rvcixcblx0XHQpO1xuXHRcdGNvbnN0IGNvbnRhaW5lclJlZjogQ29tcG9uZW50UmVmPE5nRG9jT3ZlcmxheUNvbnRhaW5lcj4gPSBvdmVybGF5LmF0dGFjaChjb250YWluZXJQb3J0YWwpO1xuXHRcdGNvbnN0IG92ZXJsYXlSZWY6IE5nRG9jT3ZlcmxheVJlZjxSPiA9IG5ldyBOZ0RvY092ZXJsYXlSZWY8Uj4oXG5cdFx0XHRvdmVybGF5LFxuXHRcdFx0Y29uZmlnLFxuXHRcdFx0Y29udGFpbmVyUmVmLmluc3RhbmNlLFxuXHRcdFx0dGhpcy5uZ1pvbmUsXG5cdFx0XHR0aGlzLnJvdXRlcixcblx0XHQpO1xuXG5cdFx0aWYgKGNvbnRlbnQgaW5zdGFuY2VvZiBQb2x5bW9ycGhldXNDb21wb25lbnQpIHtcblx0XHRcdGNvbnRlbnQgPSBuZXcgUG9seW1vcnBoZXVzQ29tcG9uZW50KFxuXHRcdFx0XHRjb250ZW50LmNvbXBvbmVudCxcblx0XHRcdFx0dGhpcy5jcmVhdGVJbmplY3RvcihvdmVybGF5UmVmLCBwcm92aWRlcnMsIGNvbmZpZy52aWV3Q29udGFpbmVyUmVmPy5pbmplY3RvciksXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGNvbnRhaW5lclJlZi5pbnN0YW5jZS5jb25maWcgPSBjb25maWc7XG5cdFx0Y29udGFpbmVyUmVmLmluc3RhbmNlLmNvbnRlbnQgPSBjb250ZW50O1xuXHRcdGNvbnRhaW5lclJlZi5pbnN0YW5jZS5tYXJrRm9yQ2hlY2soKTtcblxuXHRcdHJldHVybiBvdmVybGF5UmVmO1xuXHR9XG5cblx0cHJpdmF0ZSBjcmVhdGVPdmVybGF5KGNvbmZpZzogTmdEb2NPdmVybGF5Q29uZmlnKTogT3ZlcmxheVJlZiB7XG5cdFx0Y29uc3Qgb3ZlcmxheVJlZjogT3ZlcmxheVJlZiA9IHRoaXMub3ZlcmxheS5jcmVhdGUoY29uZmlnKTtcblx0XHRvdmVybGF5UmVmXG5cdFx0XHQuZGV0YWNobWVudHMoKVxuXHRcdFx0LnBpcGUodGFrZSgxKSlcblx0XHRcdC5zdWJzY3JpYmUoKCkgPT4ge1xuXHRcdFx0XHRvdmVybGF5UmVmLmhhc0F0dGFjaGVkKCkgJiYgb3ZlcmxheVJlZi5kZXRhY2goKTtcblx0XHRcdH0pO1xuXHRcdHJldHVybiBvdmVybGF5UmVmO1xuXHR9XG5cblx0Y29ubmVjdGVkUG9zaXRpb25TdHJhdGVneShcblx0XHRvcmlnaW46IE5nRG9jT3ZlcmxheU9yaWdpbixcblx0XHRwb3NpdGlvbnM6IE5nRG9jT3ZlcmxheVBvc2l0aW9uIHwgTmdEb2NPdmVybGF5UG9zaXRpb25bXSxcblx0KTogRmxleGlibGVDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5IHtcblx0XHRyZXR1cm4gdGhpcy5vdmVybGF5XG5cdFx0XHQucG9zaXRpb24oKVxuXHRcdFx0LmZsZXhpYmxlQ29ubmVjdGVkVG8ob3JpZ2luKVxuXHRcdFx0LndpdGhQb3NpdGlvbnMoTmdEb2NPdmVybGF5VXRpbHMudG9Db25uZWN0ZWRQb3NpdGlvbnMoYXNBcnJheShwb3NpdGlvbnMpKSlcblx0XHRcdC53aXRoUHVzaCh0cnVlKTtcblx0fVxuXG5cdGdsb2JhbFBvc2l0aW9uU3RyYXRlZ3koKTogR2xvYmFsUG9zaXRpb25TdHJhdGVneSB7XG5cdFx0cmV0dXJuIHRoaXMub3ZlcmxheS5wb3NpdGlvbigpLmdsb2JhbCgpO1xuXHR9XG5cblx0c2Nyb2xsU3RyYXRlZ3koKTogU2Nyb2xsU3RyYXRlZ3lPcHRpb25zIHtcblx0XHRyZXR1cm4gdGhpcy5vdmVybGF5LnNjcm9sbFN0cmF0ZWdpZXM7XG5cdH1cblxuXHRwcml2YXRlIGNyZWF0ZUluamVjdG9yPFI+KFxuXHRcdG92ZXJsYXlSZWY6IE5nRG9jT3ZlcmxheVJlZjxSPixcblx0XHRwcm92aWRlcnM6IFN0YXRpY1Byb3ZpZGVyW10sXG5cdFx0aW5qZWN0b3I/OiBJbmplY3Rvcixcblx0KTogSW5qZWN0b3Ige1xuXHRcdHJldHVybiBJbmplY3Rvci5jcmVhdGUoe1xuXHRcdFx0cHJvdmlkZXJzOiBbXG5cdFx0XHRcdC4uLnByb3ZpZGVycyxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHByb3ZpZGU6IE5nRG9jT3ZlcmxheVJlZixcblx0XHRcdFx0XHR1c2VWYWx1ZTogb3ZlcmxheVJlZixcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0XHRwYXJlbnQ6IGluamVjdG9yIHx8IHRoaXMuaW5qZWN0b3IsXG5cdFx0fSk7XG5cdH1cbn1cbiJdfQ==