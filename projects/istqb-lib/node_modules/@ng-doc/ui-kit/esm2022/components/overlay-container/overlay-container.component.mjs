import { AnimationBuilder } from '@angular/animations';
import { FlexibleConnectedPositionStrategy, } from '@angular/cdk/overlay';
import { DOCUMENT } from '@angular/common';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, HostBinding, Inject, NgZone, ViewChild, } from '@angular/core';
import { NgDocFocusControlComponent } from '@ng-doc/ui-kit/components/focus-control';
import { NgDocOverlayPointerComponent } from '@ng-doc/ui-kit/components/overlay-pointer';
import { NgDocEventSwitcherDirective } from '@ng-doc/ui-kit/directives/event-switcher';
import { NgDocFocusCatcherDirective } from '@ng-doc/ui-kit/directives/focus-catcher';
import { toElement } from '@ng-doc/ui-kit/helpers';
import { ngDocZoneOptimize } from '@ng-doc/ui-kit/observables';
import { NgDocFocusUtils, NgDocOverlayUtils } from '@ng-doc/ui-kit/utils';
import { PolymorpheusModule, PolymorpheusOutletDirective } from '@tinkoff/ng-polymorpheus';
import { Subject } from 'rxjs';
import { distinctUntilChanged } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/animations";
import * as i2 from "@tinkoff/ng-polymorpheus";
export class NgDocOverlayContainerComponent {
    constructor(elementRef, documentRef, changeDetectorRef, ngZone, animationBuilder) {
        this.elementRef = elementRef;
        this.documentRef = documentRef;
        this.changeDetectorRef = changeDetectorRef;
        this.ngZone = ngZone;
        this.animationBuilder = animationBuilder;
        this.relativePosition = null;
        this.content = '';
        this.animationEvent$ = new Subject();
        this.isOpened = true;
    }
    ngOnInit() {
        this.runAnimation(this.config?.openAnimation || []);
        if (this.config?.positionStrategy instanceof FlexibleConnectedPositionStrategy) {
            this.config.positionStrategy.positionChanges
                .pipe(distinctUntilChanged((a, b) => a.connectionPair === b.connectionPair), ngDocZoneOptimize(this.ngZone))
                .subscribe((change) => {
                this.currentPosition = NgDocOverlayUtils.getOverlayPosition(change.connectionPair);
                this.relativePosition = NgDocOverlayUtils.getRelativePosition(this.currentPosition);
                this.changeDetectorRef.markForCheck();
            });
        }
    }
    get contactBorder() {
        return !!this.config?.contactBorder;
    }
    get isFocused() {
        return !!this.focusCatcher?.focused;
    }
    get animationEvent() {
        return this.animationEvent$.asObservable();
    }
    get overlayAlign() {
        return this.currentPosition
            ? NgDocOverlayUtils.getPositionAlign(NgDocOverlayUtils.toConnectedPosition(this.currentPosition))
            : null;
    }
    close() {
        if (this.isOpened) {
            this.runAnimation(this.config?.closeAnimation || [], true);
            this.isOpened = false;
            this.changeDetectorRef.markForCheck();
        }
    }
    focus() {
        if (this.contentContainer) {
            NgDocFocusUtils.focusClosestElement(toElement(this.contentContainer), toElement(this.contentContainer));
        }
    }
    markForCheck() {
        this.changeDetectorRef.markForCheck();
    }
    runAnimation(animation, close = false) {
        const player = this.animationBuilder
            .build(animation)
            .create(this.elementRef.nativeElement);
        player.onStart(() => this.animationEvent$.next(close ? 'beforeClose' : 'beforeOpen'));
        player.onDone(() => this.animationEvent$.next(close ? 'afterClose' : 'afterOpen'));
        player.play();
    }
    ngOnDestroy() {
        if (this.isFocused && this.config && this.config.viewContainerRef) {
            NgDocFocusUtils.focusClosestElement(this.config.viewContainerRef.element.nativeElement, this.documentRef.body, false);
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: NgDocOverlayContainerComponent, deps: [{ token: i0.ElementRef }, { token: DOCUMENT }, { token: i0.ChangeDetectorRef }, { token: i0.NgZone }, { token: i1.AnimationBuilder }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.1.0", type: NgDocOverlayContainerComponent, isStandalone: true, selector: "ng-doc-overlay-container", host: { properties: { "attr.data-ng-doc-overlay-position": "this.relativePosition", "attr.data-ng-doc-overlay-with-contact-border": "this.contactBorder" } }, viewQueries: [{ propertyName: "contentContainer", first: true, predicate: ["contentContainer"], descendants: true, read: ElementRef, static: true }, { propertyName: "focusCatcher", first: true, predicate: NgDocFocusCatcherDirective, descendants: true }, { propertyName: "outlet", first: true, predicate: PolymorpheusOutletDirective, descendants: true, static: true }], ngImport: i0, template: "<ng-doc-overlay-pointer\n\t[overlayPosition]=\"relativePosition\"\n\t[overlayAlign]=\"overlayAlign\"\n\t[withPointer]=\"!!config?.withPointer\"\n\t[ngDocEventSwitcher]=\"config?.viewContainerRef?.element?.nativeElement ?? null\"\n\t[events]=\"['focusin', 'focusout', 'keydown', 'scroll']\">\n\t<ng-doc-focus-control\n\t\t[focusHost]=\"this.config?.viewContainerRef?.element?.nativeElement ?? null\"\n\t\tngDocFocusCatcher>\n\t\t<div class=\"ng-doc-overlay-content\" [tabIndex]=\"-1\" #contentContainer>\n\t\t\t<ng-container *polymorpheusOutlet=\"content as text\">{{ text }}</ng-container>\n\t\t</div>\n\t</ng-doc-focus-control>\n</ng-doc-overlay-pointer>\n", styles: [":host{display:block;height:auto;width:100%}.ng-doc-overlay-content{width:100%;height:100%;background-color:var(--ng-doc-overlay-background);border:1px solid var(--ng-doc-overlay-border);border-radius:var(--ng-doc-overlay-border-radius);box-shadow:var(--ng-doc-overlay-shadow);overflow:auto}:host[data-ng-doc-overlay-position=top]{transform-origin:bottom}:host[data-ng-doc-overlay-position=top][data-ng-doc-overlay-with-contact-border=false] .ng-doc-overlay-content{border-bottom:none}:host[data-ng-doc-overlay-position=bottom]{transform-origin:top}:host[data-ng-doc-overlay-position=bottom][data-ng-doc-overlay-with-contact-border=false] .ng-doc-overlay-content{border-top:none}:host[data-ng-doc-overlay-position=left]{transform-origin:right}:host[data-ng-doc-overlay-position=left][data-ng-doc-overlay-with-contact-border=false] .ng-doc-overlay-content{border-right:none}:host[data-ng-doc-overlay-position=right]{transform-origin:left}:host[data-ng-doc-overlay-position=right][data-ng-doc-overlay-with-contact-border=false] .ng-doc-overlay-content{border-left:none}\n"], dependencies: [{ kind: "component", type: NgDocOverlayPointerComponent, selector: "ng-doc-overlay-pointer", inputs: ["overlayPosition", "overlayAlign", "withPointer"] }, { kind: "directive", type: NgDocEventSwitcherDirective, selector: "[ngDocEventSwitcher]", inputs: ["ngDocEventSwitcher", "events"] }, { kind: "component", type: NgDocFocusControlComponent, selector: "ng-doc-focus-control", inputs: ["focusHost"] }, { kind: "directive", type: NgDocFocusCatcherDirective, selector: "[ngDocFocusCatcher]", outputs: ["focusEvent", "blurEvent"], exportAs: ["ngDocFocusCatcher"] }, { kind: "ngmodule", type: PolymorpheusModule }, { kind: "directive", type: i2.PolymorpheusOutletDirective, selector: "[polymorpheusOutlet]", inputs: ["polymorpheusOutlet", "polymorpheusOutletContext"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: NgDocOverlayContainerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ng-doc-overlay-container', changeDetection: ChangeDetectionStrategy.OnPush, standalone: true, imports: [
                        NgDocOverlayPointerComponent,
                        NgDocEventSwitcherDirective,
                        NgDocFocusControlComponent,
                        NgDocFocusCatcherDirective,
                        PolymorpheusModule,
                    ], template: "<ng-doc-overlay-pointer\n\t[overlayPosition]=\"relativePosition\"\n\t[overlayAlign]=\"overlayAlign\"\n\t[withPointer]=\"!!config?.withPointer\"\n\t[ngDocEventSwitcher]=\"config?.viewContainerRef?.element?.nativeElement ?? null\"\n\t[events]=\"['focusin', 'focusout', 'keydown', 'scroll']\">\n\t<ng-doc-focus-control\n\t\t[focusHost]=\"this.config?.viewContainerRef?.element?.nativeElement ?? null\"\n\t\tngDocFocusCatcher>\n\t\t<div class=\"ng-doc-overlay-content\" [tabIndex]=\"-1\" #contentContainer>\n\t\t\t<ng-container *polymorpheusOutlet=\"content as text\">{{ text }}</ng-container>\n\t\t</div>\n\t</ng-doc-focus-control>\n</ng-doc-overlay-pointer>\n", styles: [":host{display:block;height:auto;width:100%}.ng-doc-overlay-content{width:100%;height:100%;background-color:var(--ng-doc-overlay-background);border:1px solid var(--ng-doc-overlay-border);border-radius:var(--ng-doc-overlay-border-radius);box-shadow:var(--ng-doc-overlay-shadow);overflow:auto}:host[data-ng-doc-overlay-position=top]{transform-origin:bottom}:host[data-ng-doc-overlay-position=top][data-ng-doc-overlay-with-contact-border=false] .ng-doc-overlay-content{border-bottom:none}:host[data-ng-doc-overlay-position=bottom]{transform-origin:top}:host[data-ng-doc-overlay-position=bottom][data-ng-doc-overlay-with-contact-border=false] .ng-doc-overlay-content{border-top:none}:host[data-ng-doc-overlay-position=left]{transform-origin:right}:host[data-ng-doc-overlay-position=left][data-ng-doc-overlay-with-contact-border=false] .ng-doc-overlay-content{border-right:none}:host[data-ng-doc-overlay-position=right]{transform-origin:left}:host[data-ng-doc-overlay-position=right][data-ng-doc-overlay-with-contact-border=false] .ng-doc-overlay-content{border-left:none}\n"] }]
        }], ctorParameters: () => [{ type: i0.ElementRef }, { type: Document, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }, { type: i0.ChangeDetectorRef }, { type: i0.NgZone }, { type: i1.AnimationBuilder }], propDecorators: { contentContainer: [{
                type: ViewChild,
                args: ['contentContainer', { read: ElementRef, static: true }]
            }], focusCatcher: [{
                type: ViewChild,
                args: [NgDocFocusCatcherDirective]
            }], outlet: [{
                type: ViewChild,
                args: [PolymorpheusOutletDirective, { static: true }]
            }], relativePosition: [{
                type: HostBinding,
                args: ['attr.data-ng-doc-overlay-position']
            }], contactBorder: [{
                type: HostBinding,
                args: ['attr.data-ng-doc-overlay-with-contact-border']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3ZlcmxheS1jb250YWluZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy91aS1raXQvY29tcG9uZW50cy9vdmVybGF5LWNvbnRhaW5lci9vdmVybGF5LWNvbnRhaW5lci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL3VpLWtpdC9jb21wb25lbnRzL292ZXJsYXktY29udGFpbmVyL292ZXJsYXktY29udGFpbmVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBc0MsTUFBTSxxQkFBcUIsQ0FBQztBQUMzRixPQUFPLEVBRU4saUNBQWlDLEdBQ2pDLE1BQU0sc0JBQXNCLENBQUM7QUFDOUIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFDTix1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsV0FBVyxFQUNYLE1BQU0sRUFDTixNQUFNLEVBR04sU0FBUyxHQUNULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQ3JGLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQ3pGLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQ3JGLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUVuRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQVMvRCxPQUFPLEVBQUUsZUFBZSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDMUUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLDJCQUEyQixF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dEMsMEJBQTBCLHlFQUcxQiwyQkFBMkIsOERDM0R2QyxtcEJBY0Esc21DRCtCRSw0QkFBNEIsK0hBQzVCLDJCQUEyQiwyR0FDM0IsMEJBQTBCLHdGQUMxQiwwQkFBMEIsc0lBQzFCLGtCQUFrQjs7MkZBR1AsOEJBQThCO2tCQWQxQyxTQUFTOytCQUNDLDBCQUEwQixtQkFHbkIsdUJBQXVCLENBQUMsTUFBTSxjQUNuQyxJQUFJLFdBQ1A7d0JBQ1IsNEJBQTRCO3dCQUM1QiwyQkFBMkI7d0JBQzNCLDBCQUEwQjt3QkFDMUIsMEJBQTBCO3dCQUMxQixrQkFBa0I7cUJBQ2xCOzswQkF5QkMsTUFBTTsyQkFBQyxRQUFROzZIQXJCakIsZ0JBQWdCO3NCQURmLFNBQVM7dUJBQUMsa0JBQWtCLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBSWpFLFlBQVk7c0JBRFgsU0FBUzt1QkFBQywwQkFBMEI7Z0JBSXJDLE1BQU07c0JBREwsU0FBUzt1QkFBQywyQkFBMkIsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBSXhELGdCQUFnQjtzQkFEZixXQUFXO3VCQUFDLG1DQUFtQztnQkF1QzVDLGFBQWE7c0JBRGhCLFdBQVc7dUJBQUMsOENBQThDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQW5pbWF0aW9uQnVpbGRlciwgQW5pbWF0aW9uTWV0YWRhdGEsIEFuaW1hdGlvblBsYXllciB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHtcblx0Q29ubmVjdGVkT3ZlcmxheVBvc2l0aW9uQ2hhbmdlLFxuXHRGbGV4aWJsZUNvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3ksXG59IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7XG5cdENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuXHRDaGFuZ2VEZXRlY3RvclJlZixcblx0Q29tcG9uZW50LFxuXHRFbGVtZW50UmVmLFxuXHRIb3N0QmluZGluZyxcblx0SW5qZWN0LFxuXHROZ1pvbmUsXG5cdE9uRGVzdHJveSxcblx0T25Jbml0LFxuXHRWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmdEb2NGb2N1c0NvbnRyb2xDb21wb25lbnQgfSBmcm9tICdAbmctZG9jL3VpLWtpdC9jb21wb25lbnRzL2ZvY3VzLWNvbnRyb2wnO1xuaW1wb3J0IHsgTmdEb2NPdmVybGF5UG9pbnRlckNvbXBvbmVudCB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L2NvbXBvbmVudHMvb3ZlcmxheS1wb2ludGVyJztcbmltcG9ydCB7IE5nRG9jRXZlbnRTd2l0Y2hlckRpcmVjdGl2ZSB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L2RpcmVjdGl2ZXMvZXZlbnQtc3dpdGNoZXInO1xuaW1wb3J0IHsgTmdEb2NGb2N1c0NhdGNoZXJEaXJlY3RpdmUgfSBmcm9tICdAbmctZG9jL3VpLWtpdC9kaXJlY3RpdmVzL2ZvY3VzLWNhdGNoZXInO1xuaW1wb3J0IHsgdG9FbGVtZW50IH0gZnJvbSAnQG5nLWRvYy91aS1raXQvaGVscGVycyc7XG5pbXBvcnQgeyBOZ0RvY092ZXJsYXlDb25maWcsIE5nRG9jT3ZlcmxheUNvbnRhaW5lciB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgbmdEb2Nab25lT3B0aW1pemUgfSBmcm9tICdAbmctZG9jL3VpLWtpdC9vYnNlcnZhYmxlcyc7XG5pbXBvcnQge1xuXHROZ0RvY0NvbnRlbnQsXG5cdE5nRG9jSG9yaXpvbnRhbEFsaWduLFxuXHROZ0RvY092ZXJsYXlBbmltYXRpb25FdmVudCxcblx0TmdEb2NPdmVybGF5UG9zaXRpb24sXG5cdE5nRG9jT3ZlcmxheVJlbGF0aXZlUG9zaXRpb24sXG5cdE5nRG9jVmVydGljYWxBbGlnbixcbn0gZnJvbSAnQG5nLWRvYy91aS1raXQvdHlwZXMnO1xuaW1wb3J0IHsgTmdEb2NGb2N1c1V0aWxzLCBOZ0RvY092ZXJsYXlVdGlscyB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L3V0aWxzJztcbmltcG9ydCB7IFBvbHltb3JwaGV1c01vZHVsZSwgUG9seW1vcnBoZXVzT3V0bGV0RGlyZWN0aXZlIH0gZnJvbSAnQHRpbmtvZmYvbmctcG9seW1vcnBoZXVzJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6ICduZy1kb2Mtb3ZlcmxheS1jb250YWluZXInLFxuXHR0ZW1wbGF0ZVVybDogJy4vb3ZlcmxheS1jb250YWluZXIuY29tcG9uZW50Lmh0bWwnLFxuXHRzdHlsZVVybHM6IFsnLi9vdmVybGF5LWNvbnRhaW5lci5jb21wb25lbnQuc2NzcyddLFxuXHRjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcblx0c3RhbmRhbG9uZTogdHJ1ZSxcblx0aW1wb3J0czogW1xuXHRcdE5nRG9jT3ZlcmxheVBvaW50ZXJDb21wb25lbnQsXG5cdFx0TmdEb2NFdmVudFN3aXRjaGVyRGlyZWN0aXZlLFxuXHRcdE5nRG9jRm9jdXNDb250cm9sQ29tcG9uZW50LFxuXHRcdE5nRG9jRm9jdXNDYXRjaGVyRGlyZWN0aXZlLFxuXHRcdFBvbHltb3JwaGV1c01vZHVsZSxcblx0XSxcbn0pXG5leHBvcnQgY2xhc3MgTmdEb2NPdmVybGF5Q29udGFpbmVyQ29tcG9uZW50IGltcGxlbWVudHMgTmdEb2NPdmVybGF5Q29udGFpbmVyLCBPbkluaXQsIE9uRGVzdHJveSB7XG5cdEBWaWV3Q2hpbGQoJ2NvbnRlbnRDb250YWluZXInLCB7IHJlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KVxuXHRjb250ZW50Q29udGFpbmVyPzogRWxlbWVudFJlZjxIVE1MRWxlbWVudD47XG5cblx0QFZpZXdDaGlsZChOZ0RvY0ZvY3VzQ2F0Y2hlckRpcmVjdGl2ZSlcblx0Zm9jdXNDYXRjaGVyPzogTmdEb2NGb2N1c0NhdGNoZXJEaXJlY3RpdmU7XG5cblx0QFZpZXdDaGlsZChQb2x5bW9ycGhldXNPdXRsZXREaXJlY3RpdmUsIHsgc3RhdGljOiB0cnVlIH0pXG5cdG91dGxldD86IFBvbHltb3JwaGV1c091dGxldERpcmVjdGl2ZTxvYmplY3Q+O1xuXG5cdEBIb3N0QmluZGluZygnYXR0ci5kYXRhLW5nLWRvYy1vdmVybGF5LXBvc2l0aW9uJylcblx0cmVsYXRpdmVQb3NpdGlvbjogTmdEb2NPdmVybGF5UmVsYXRpdmVQb3NpdGlvbiB8IG51bGwgPSBudWxsO1xuXG5cdGNvbmZpZz86IE5nRG9jT3ZlcmxheUNvbmZpZztcblx0Y29udGVudDogTmdEb2NDb250ZW50ID0gJyc7XG5cblx0cHJpdmF0ZSBjdXJyZW50UG9zaXRpb24/OiBOZ0RvY092ZXJsYXlQb3NpdGlvbjtcblx0cHJpdmF0ZSBhbmltYXRpb25FdmVudCQ6IFN1YmplY3Q8TmdEb2NPdmVybGF5QW5pbWF0aW9uRXZlbnQ+ID1cblx0XHRuZXcgU3ViamVjdDxOZ0RvY092ZXJsYXlBbmltYXRpb25FdmVudD4oKTtcblx0cHJpdmF0ZSBpc09wZW5lZDogYm9vbGVhbiA9IHRydWU7XG5cblx0Y29uc3RydWN0b3IoXG5cdFx0cHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50Pixcblx0XHRASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50UmVmOiBEb2N1bWVudCxcblx0XHRwcml2YXRlIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcblx0XHRwcml2YXRlIG5nWm9uZTogTmdab25lLFxuXHRcdHByaXZhdGUgYW5pbWF0aW9uQnVpbGRlcjogQW5pbWF0aW9uQnVpbGRlcixcblx0KSB7fVxuXG5cdG5nT25Jbml0KCk6IHZvaWQge1xuXHRcdHRoaXMucnVuQW5pbWF0aW9uKHRoaXMuY29uZmlnPy5vcGVuQW5pbWF0aW9uIHx8IFtdKTtcblx0XHRpZiAodGhpcy5jb25maWc/LnBvc2l0aW9uU3RyYXRlZ3kgaW5zdGFuY2VvZiBGbGV4aWJsZUNvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3kpIHtcblx0XHRcdHRoaXMuY29uZmlnLnBvc2l0aW9uU3RyYXRlZ3kucG9zaXRpb25DaGFuZ2VzXG5cdFx0XHRcdC5waXBlKFxuXHRcdFx0XHRcdGRpc3RpbmN0VW50aWxDaGFuZ2VkKFxuXHRcdFx0XHRcdFx0KGE6IENvbm5lY3RlZE92ZXJsYXlQb3NpdGlvbkNoYW5nZSwgYjogQ29ubmVjdGVkT3ZlcmxheVBvc2l0aW9uQ2hhbmdlKSA9PlxuXHRcdFx0XHRcdFx0XHRhLmNvbm5lY3Rpb25QYWlyID09PSBiLmNvbm5lY3Rpb25QYWlyLFxuXHRcdFx0XHRcdCksXG5cdFx0XHRcdFx0bmdEb2Nab25lT3B0aW1pemUodGhpcy5uZ1pvbmUpLFxuXHRcdFx0XHQpXG5cdFx0XHRcdC5zdWJzY3JpYmUoKGNoYW5nZTogQ29ubmVjdGVkT3ZlcmxheVBvc2l0aW9uQ2hhbmdlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5jdXJyZW50UG9zaXRpb24gPSBOZ0RvY092ZXJsYXlVdGlscy5nZXRPdmVybGF5UG9zaXRpb24oY2hhbmdlLmNvbm5lY3Rpb25QYWlyKTtcblx0XHRcdFx0XHR0aGlzLnJlbGF0aXZlUG9zaXRpb24gPSBOZ0RvY092ZXJsYXlVdGlscy5nZXRSZWxhdGl2ZVBvc2l0aW9uKHRoaXMuY3VycmVudFBvc2l0aW9uKTtcblx0XHRcdFx0XHR0aGlzLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuXHRcdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHRASG9zdEJpbmRpbmcoJ2F0dHIuZGF0YS1uZy1kb2Mtb3ZlcmxheS13aXRoLWNvbnRhY3QtYm9yZGVyJylcblx0Z2V0IGNvbnRhY3RCb3JkZXIoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuICEhdGhpcy5jb25maWc/LmNvbnRhY3RCb3JkZXI7XG5cdH1cblxuXHRnZXQgaXNGb2N1c2VkKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiAhIXRoaXMuZm9jdXNDYXRjaGVyPy5mb2N1c2VkO1xuXHR9XG5cblx0Z2V0IGFuaW1hdGlvbkV2ZW50KCk6IE9ic2VydmFibGU8TmdEb2NPdmVybGF5QW5pbWF0aW9uRXZlbnQ+IHtcblx0XHRyZXR1cm4gdGhpcy5hbmltYXRpb25FdmVudCQuYXNPYnNlcnZhYmxlKCk7XG5cdH1cblxuXHRnZXQgb3ZlcmxheUFsaWduKCk6IE5nRG9jSG9yaXpvbnRhbEFsaWduIHwgTmdEb2NWZXJ0aWNhbEFsaWduIHwgbnVsbCB7XG5cdFx0cmV0dXJuIHRoaXMuY3VycmVudFBvc2l0aW9uXG5cdFx0XHQ/IE5nRG9jT3ZlcmxheVV0aWxzLmdldFBvc2l0aW9uQWxpZ24oXG5cdFx0XHRcdFx0TmdEb2NPdmVybGF5VXRpbHMudG9Db25uZWN0ZWRQb3NpdGlvbih0aGlzLmN1cnJlbnRQb3NpdGlvbiksXG5cdFx0XHQgIClcblx0XHRcdDogbnVsbDtcblx0fVxuXG5cdGNsb3NlKCk6IHZvaWQge1xuXHRcdGlmICh0aGlzLmlzT3BlbmVkKSB7XG5cdFx0XHR0aGlzLnJ1bkFuaW1hdGlvbih0aGlzLmNvbmZpZz8uY2xvc2VBbmltYXRpb24gfHwgW10sIHRydWUpO1xuXHRcdFx0dGhpcy5pc09wZW5lZCA9IGZhbHNlO1xuXHRcdFx0dGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcblx0XHR9XG5cdH1cblxuXHRmb2N1cygpOiB2b2lkIHtcblx0XHRpZiAodGhpcy5jb250ZW50Q29udGFpbmVyKSB7XG5cdFx0XHROZ0RvY0ZvY3VzVXRpbHMuZm9jdXNDbG9zZXN0RWxlbWVudChcblx0XHRcdFx0dG9FbGVtZW50KHRoaXMuY29udGVudENvbnRhaW5lciksXG5cdFx0XHRcdHRvRWxlbWVudCh0aGlzLmNvbnRlbnRDb250YWluZXIpLFxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRtYXJrRm9yQ2hlY2soKTogdm9pZCB7XG5cdFx0dGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcblx0fVxuXG5cdHByaXZhdGUgcnVuQW5pbWF0aW9uKGFuaW1hdGlvbjogQW5pbWF0aW9uTWV0YWRhdGFbXSwgY2xvc2U6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xuXHRcdGNvbnN0IHBsYXllcjogQW5pbWF0aW9uUGxheWVyID0gdGhpcy5hbmltYXRpb25CdWlsZGVyXG5cdFx0XHQuYnVpbGQoYW5pbWF0aW9uKVxuXHRcdFx0LmNyZWF0ZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XG5cdFx0cGxheWVyLm9uU3RhcnQoKCkgPT4gdGhpcy5hbmltYXRpb25FdmVudCQubmV4dChjbG9zZSA/ICdiZWZvcmVDbG9zZScgOiAnYmVmb3JlT3BlbicpKTtcblx0XHRwbGF5ZXIub25Eb25lKCgpID0+IHRoaXMuYW5pbWF0aW9uRXZlbnQkLm5leHQoY2xvc2UgPyAnYWZ0ZXJDbG9zZScgOiAnYWZ0ZXJPcGVuJykpO1xuXHRcdHBsYXllci5wbGF5KCk7XG5cdH1cblxuXHRuZ09uRGVzdHJveSgpOiB2b2lkIHtcblx0XHRpZiAodGhpcy5pc0ZvY3VzZWQgJiYgdGhpcy5jb25maWcgJiYgdGhpcy5jb25maWcudmlld0NvbnRhaW5lclJlZikge1xuXHRcdFx0TmdEb2NGb2N1c1V0aWxzLmZvY3VzQ2xvc2VzdEVsZW1lbnQoXG5cdFx0XHRcdHRoaXMuY29uZmlnLnZpZXdDb250YWluZXJSZWYuZWxlbWVudC5uYXRpdmVFbGVtZW50LFxuXHRcdFx0XHR0aGlzLmRvY3VtZW50UmVmLmJvZHksXG5cdFx0XHRcdGZhbHNlLFxuXHRcdFx0KTtcblx0XHR9XG5cdH1cbn1cbiIsIjxuZy1kb2Mtb3ZlcmxheS1wb2ludGVyXG5cdFtvdmVybGF5UG9zaXRpb25dPVwicmVsYXRpdmVQb3NpdGlvblwiXG5cdFtvdmVybGF5QWxpZ25dPVwib3ZlcmxheUFsaWduXCJcblx0W3dpdGhQb2ludGVyXT1cIiEhY29uZmlnPy53aXRoUG9pbnRlclwiXG5cdFtuZ0RvY0V2ZW50U3dpdGNoZXJdPVwiY29uZmlnPy52aWV3Q29udGFpbmVyUmVmPy5lbGVtZW50Py5uYXRpdmVFbGVtZW50ID8/IG51bGxcIlxuXHRbZXZlbnRzXT1cIlsnZm9jdXNpbicsICdmb2N1c291dCcsICdrZXlkb3duJywgJ3Njcm9sbCddXCI+XG5cdDxuZy1kb2MtZm9jdXMtY29udHJvbFxuXHRcdFtmb2N1c0hvc3RdPVwidGhpcy5jb25maWc/LnZpZXdDb250YWluZXJSZWY/LmVsZW1lbnQ/Lm5hdGl2ZUVsZW1lbnQgPz8gbnVsbFwiXG5cdFx0bmdEb2NGb2N1c0NhdGNoZXI+XG5cdFx0PGRpdiBjbGFzcz1cIm5nLWRvYy1vdmVybGF5LWNvbnRlbnRcIiBbdGFiSW5kZXhdPVwiLTFcIiAjY29udGVudENvbnRhaW5lcj5cblx0XHRcdDxuZy1jb250YWluZXIgKnBvbHltb3JwaGV1c091dGxldD1cImNvbnRlbnQgYXMgdGV4dFwiPnt7IHRleHQgfX08L25nLWNvbnRhaW5lcj5cblx0XHQ8L2Rpdj5cblx0PC9uZy1kb2MtZm9jdXMtY29udHJvbD5cbjwvbmctZG9jLW92ZXJsYXktcG9pbnRlcj5cbiJdfQ==