"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addBuildCandidates = addBuildCandidates;
const core_1 = require("@ng-doc/core");
const operators_1 = require("rxjs/operators");
const helpers_1 = require("../../helpers");
/**
 *
 * @param store
 */
function addBuildCandidates(store) {
    return (source) => source.pipe((0, operators_1.tap)(() => {
        store
            .asArray()
            .forEach((entity) => !entity.destroyed && (0, helpers_1.isFileEntity)(entity) && entity.setParentDynamically());
    }), (0, operators_1.map)((entities) => (0, core_1.unique)(entities, entities.map((e) => e.buildCandidates).flat(), 
    /*
     * We need to add the build candidates of the entities which has errors or warnings too,
     * just to rebuild their parents too e.g. to remove a broken page from a category.
     */
    store
        .getAllWithErrorsOrWarnings()
        .map((e) => e.buildCandidates)
        .flat())));
}
//# sourceMappingURL=add-build-candidates.js.map