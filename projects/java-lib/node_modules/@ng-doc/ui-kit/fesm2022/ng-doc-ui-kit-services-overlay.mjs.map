{"version":3,"file":"ng-doc-ui-kit-services-overlay.mjs","sources":["../../../../libs/ui-kit/services/overlay/overlay.service.ts","../../../../libs/ui-kit/services/overlay/ng-doc-ui-kit-services-overlay.ts"],"sourcesContent":["import {\n\tFlexibleConnectedPositionStrategy,\n\tGlobalPositionStrategy,\n\tOverlay,\n\tOverlayRef,\n\tScrollStrategyOptions,\n} from '@angular/cdk/overlay';\nimport { ComponentPortal } from '@angular/cdk/portal';\nimport {\n\tComponentRef,\n\tInjectable,\n\tInjector,\n\tNgZone,\n\tOptional,\n\tStaticProvider,\n} from '@angular/core';\nimport { Router } from '@angular/router';\nimport { asArray } from '@ng-doc/core/helpers/as-array';\nimport { NgDocOverlayRef } from '@ng-doc/ui-kit/classes';\nimport { NgDocOverlayConfig, NgDocOverlayContainer } from '@ng-doc/ui-kit/interfaces';\nimport { NgDocContent, NgDocOverlayOrigin, NgDocOverlayPosition } from '@ng-doc/ui-kit/types';\nimport { NgDocOverlayUtils } from '@ng-doc/ui-kit/utils';\nimport { PolymorpheusComponent } from '@tinkoff/ng-polymorpheus';\nimport { take } from 'rxjs/operators';\n\n@Injectable({ providedIn: 'root' })\nexport class NgDocOverlayService {\n\tconstructor(\n\t\tprivate overlay: Overlay,\n\t\tprivate ngZone: NgZone,\n\t\tprivate injector: Injector,\n\t\t@Optional()\n\t\tprivate router?: Router,\n\t) {}\n\n\topen<R>(\n\t\tcontent: NgDocContent,\n\t\tconfig: NgDocOverlayConfig,\n\t\tproviders: StaticProvider[] = [],\n\t): NgDocOverlayRef<R> {\n\t\tconst overlayRef: OverlayRef = this.createOverlay(config);\n\t\treturn this.attachTooltipContainer(content, overlayRef, config, providers);\n\t}\n\n\tprivate attachTooltipContainer<R>(\n\t\tcontent: NgDocContent,\n\t\toverlay: OverlayRef,\n\t\tconfig: NgDocOverlayConfig,\n\t\tproviders: StaticProvider[],\n\t): NgDocOverlayRef<R> {\n\t\tconst containerPortal: ComponentPortal<NgDocOverlayContainer> = new ComponentPortal(\n\t\t\tconfig.overlayContainer,\n\t\t\tconfig.viewContainerRef,\n\t\t\tconfig.viewContainerRef?.injector,\n\t\t);\n\t\tconst containerRef: ComponentRef<NgDocOverlayContainer> = overlay.attach(containerPortal);\n\t\tconst overlayRef: NgDocOverlayRef<R> = new NgDocOverlayRef<R>(\n\t\t\toverlay,\n\t\t\tconfig,\n\t\t\tcontainerRef.instance,\n\t\t\tthis.ngZone,\n\t\t\tthis.router,\n\t\t);\n\n\t\tif (content instanceof PolymorpheusComponent) {\n\t\t\tcontent = new PolymorpheusComponent(\n\t\t\t\tcontent.component,\n\t\t\t\tthis.createInjector(overlayRef, providers, config.viewContainerRef?.injector),\n\t\t\t);\n\t\t}\n\n\t\tcontainerRef.instance.config = config;\n\t\tcontainerRef.instance.content = content;\n\t\tcontainerRef.instance.markForCheck();\n\n\t\treturn overlayRef;\n\t}\n\n\tprivate createOverlay(config: NgDocOverlayConfig): OverlayRef {\n\t\tconst overlayRef: OverlayRef = this.overlay.create(config);\n\t\toverlayRef\n\t\t\t.detachments()\n\t\t\t.pipe(take(1))\n\t\t\t.subscribe(() => {\n\t\t\t\toverlayRef.hasAttached() && overlayRef.detach();\n\t\t\t});\n\t\treturn overlayRef;\n\t}\n\n\tconnectedPositionStrategy(\n\t\torigin: NgDocOverlayOrigin,\n\t\tpositions: NgDocOverlayPosition | NgDocOverlayPosition[],\n\t): FlexibleConnectedPositionStrategy {\n\t\treturn this.overlay\n\t\t\t.position()\n\t\t\t.flexibleConnectedTo(origin)\n\t\t\t.withPositions(NgDocOverlayUtils.toConnectedPositions(asArray(positions)))\n\t\t\t.withPush(true);\n\t}\n\n\tglobalPositionStrategy(): GlobalPositionStrategy {\n\t\treturn this.overlay.position().global();\n\t}\n\n\tscrollStrategy(): ScrollStrategyOptions {\n\t\treturn this.overlay.scrollStrategies;\n\t}\n\n\tprivate createInjector<R>(\n\t\toverlayRef: NgDocOverlayRef<R>,\n\t\tproviders: StaticProvider[],\n\t\tinjector?: Injector,\n\t): Injector {\n\t\treturn Injector.create({\n\t\t\tproviders: [\n\t\t\t\t...providers,\n\t\t\t\t{\n\t\t\t\t\tprovide: NgDocOverlayRef,\n\t\t\t\t\tuseValue: overlayRef,\n\t\t\t\t},\n\t\t\t],\n\t\t\tparent: injector || this.injector,\n\t\t});\n\t}\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}