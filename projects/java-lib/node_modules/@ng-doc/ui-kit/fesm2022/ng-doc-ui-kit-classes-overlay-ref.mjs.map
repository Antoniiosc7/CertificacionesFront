{"version":3,"file":"ng-doc-ui-kit-classes-overlay-ref.mjs","sources":["../../../../libs/ui-kit/classes/overlay-ref/overlay-ref.ts","../../../../libs/ui-kit/classes/overlay-ref/ng-doc-ui-kit-classes-overlay-ref.ts"],"sourcesContent":["import {\n\tConnectedOverlayPositionChange,\n\tFlexibleConnectedPositionStrategy,\n\tOverlayRef,\n} from '@angular/cdk/overlay';\nimport { Location } from '@angular/common';\nimport { NgZone } from '@angular/core';\nimport { Event, NavigationEnd, Router } from '@angular/router';\nimport { isPresent } from '@ng-doc/core/helpers/is-present';\nimport { toElement } from '@ng-doc/ui-kit/helpers';\nimport { NgDocOverlayConfig, NgDocOverlayContainer } from '@ng-doc/ui-kit/interfaces';\nimport { fromSubscribe, ngDocZoneDetach, ngDocZoneOptimize } from '@ng-doc/ui-kit/observables';\nimport { NgDocOverlayAnimationEvent } from '@ng-doc/ui-kit/types';\nimport { fromEvent, merge, NEVER, Observable } from 'rxjs';\nimport { debounceTime, filter, map, pairwise, switchMap, take, takeUntil } from 'rxjs/operators';\n\nexport class NgDocOverlayRef<T = unknown> {\n\tprivate overlayResult: T | null = null;\n\tprivate opened: boolean = true;\n\n\tconstructor(\n\t\treadonly overlayRef: OverlayRef,\n\t\tprivate readonly overlayConfig: NgDocOverlayConfig,\n\t\treadonly overlayContainer: NgDocOverlayContainer,\n\t\tprivate readonly ngZone: NgZone,\n\t\tprivate readonly router?: Router,\n\t\tprivate readonly location?: Location,\n\t) {\n\t\t/* Closes overlay when it was outside click */\n\t\tthis.afterOpen()\n\t\t\t.pipe(\n\t\t\t\tswitchMap(() =>\n\t\t\t\t\tthis.ngZone.runOutsideAngular(() => this.overlayRef.outsidePointerEvents()),\n\t\t\t\t),\n\t\t\t\tfilter(\n\t\t\t\t\t(event: MouseEvent) =>\n\t\t\t\t\t\t!!this.overlayConfig.closeIfOutsideClick && this.outsideClickChecker(event),\n\t\t\t\t),\n\t\t\t\tngDocZoneOptimize(this.ngZone),\n\t\t\t)\n\t\t\t.subscribe(() => this.close());\n\n\t\t/* Closes overlay when it was inner click */\n\t\tfromEvent(this.overlayRef.overlayElement, 'click')\n\t\t\t.pipe(\n\t\t\t\tfilter(() => !!this.overlayConfig.closeIfInnerClick),\n\t\t\t\ttakeUntil(this.overlayRef.detachments()),\n\t\t\t\tngDocZoneOptimize(this.ngZone),\n\t\t\t)\n\t\t\t.subscribe(() => this.close());\n\n\t\t/* Closes overlay if route was changed */\n\t\tif (this.router && this.overlayConfig.disposeOnRouteNavigation) {\n\t\t\tthis.router.events\n\t\t\t\t.pipe(\n\t\t\t\t\tfilter((event: Event) => event instanceof NavigationEnd),\n\t\t\t\t\tngDocZoneOptimize(this.ngZone),\n\t\t\t\t\ttakeUntil(this.overlayRef.detachments()),\n\t\t\t\t)\n\t\t\t\t.subscribe(() => this.close());\n\t\t}\n\n\t\tif (this.location && this.overlayConfig.disposeOnNavigation) {\n\t\t\tfromSubscribe(this.location)\n\t\t\t\t.pipe(takeUntil(this.overlayRef.detachments()))\n\t\t\t\t.subscribe(() => this.close());\n\t\t}\n\n\t\tif (!this.overlayConfig.disableClose) {\n\t\t\tmerge(\n\t\t\t\tthis.overlayRef.backdropClick(),\n\t\t\t\tthis.overlayRef.keydownEvents().pipe(filter((e: KeyboardEvent) => e.code === 'Escape')),\n\t\t\t)\n\t\t\t\t.pipe(take(1), takeUntil(this.overlayRef.detachments()))\n\t\t\t\t.subscribe(() => this.close());\n\t\t}\n\n\t\t/* Update position if origin changes its position */\n\t\tconst origin: unknown = toElement(this.overlayConfig.origin);\n\n\t\tif (origin instanceof HTMLElement) {\n\t\t\tthis.ngZone.onStable\n\t\t\t\t.pipe(\n\t\t\t\t\tdebounceTime(10),\n\t\t\t\t\tmap(() => origin.getBoundingClientRect()),\n\t\t\t\t\tpairwise(),\n\t\t\t\t\tfilter(\n\t\t\t\t\t\t([a, b]: [DOMRect, DOMRect]) =>\n\t\t\t\t\t\t\tisPresent(a) &&\n\t\t\t\t\t\t\tisPresent(b) &&\n\t\t\t\t\t\t\t(a.x !== b.x || a.y !== b.y || a.width !== b.width || a.height !== b.height),\n\t\t\t\t\t),\n\t\t\t\t\tngDocZoneDetach(this.ngZone),\n\t\t\t\t\ttakeUntil(this.overlayRef.detachments()),\n\t\t\t\t)\n\t\t\t\t.subscribe(() => this.overlayRef.updatePosition());\n\t\t}\n\t}\n\n\t/** Sets focus to overlay */\n\tfocus(): void {\n\t\tthis.overlayContainer.focus();\n\t}\n\n\t/** Overlay has focus */\n\tget isFocused(): boolean {\n\t\treturn this.overlayContainer.isFocused;\n\t}\n\n\t/** Overlay is opened */\n\tget isOpened(): boolean {\n\t\treturn this.opened;\n\t}\n\n\t/** Overlay has attached */\n\tget hasAttached(): boolean {\n\t\treturn this.overlayRef.hasAttached();\n\t}\n\n\t/**\n\t * Closes overlay\n\t * @param closeResult\n\t */\n\tclose(closeResult?: T): void {\n\t\tthis.overlayResult = isPresent(closeResult) ? closeResult : null;\n\t\tthis.afterClose().subscribe(() => void this.overlayRef.detach());\n\t\tthis.overlayContainer.close();\n\t\tthis.overlayRef.detachBackdrop();\n\t\tthis.opened = false;\n\t}\n\n\tbeforeOpen(): Observable<void> {\n\t\treturn this.overlayContainer.animationEvent.pipe(\n\t\t\tfilter((event: NgDocOverlayAnimationEvent) => event === 'beforeOpen'),\n\t\t\ttake(1),\n\t\t\tmap(() => void 0),\n\t\t);\n\t}\n\n\tafterOpen(): Observable<void> {\n\t\treturn this.overlayContainer.animationEvent.pipe(\n\t\t\tfilter((event: NgDocOverlayAnimationEvent) => event === 'afterOpen'),\n\t\t\ttake(1),\n\t\t\tmap(() => void 0),\n\t\t);\n\t}\n\n\tbeforeClose(): Observable<T | null> {\n\t\treturn merge(\n\t\t\tthis.overlayContainer.animationEvent.pipe(\n\t\t\t\tfilter((event: NgDocOverlayAnimationEvent) => event === 'beforeClose'),\n\t\t\t),\n\t\t\tthis.overlayRef.detachments(),\n\t\t).pipe(\n\t\t\ttake(1),\n\t\t\tmap(() => this.overlayResult),\n\t\t);\n\t}\n\n\tafterClose(): Observable<T | null> {\n\t\treturn merge(\n\t\t\tthis.overlayContainer.animationEvent.pipe(\n\t\t\t\tfilter((event: NgDocOverlayAnimationEvent) => event === 'afterClose'),\n\t\t\t),\n\t\t\tthis.overlayRef.detachments(),\n\t\t).pipe(\n\t\t\ttake(1),\n\t\t\tmap(() => this.overlayResult),\n\t\t);\n\t}\n\n\tpositionChanges(): Observable<ConnectedOverlayPositionChange> {\n\t\treturn this.overlayConfig.positionStrategy instanceof FlexibleConnectedPositionStrategy\n\t\t\t? this.overlayConfig.positionStrategy.positionChanges\n\t\t\t: NEVER;\n\t}\n\n\tprivate outsideClickChecker(event: MouseEvent): boolean {\n\t\tconst target: EventTarget | null = event.target;\n\t\tif (target instanceof Element) {\n\t\t\tconst origin: unknown = toElement(this.overlayConfig.origin);\n\t\t\tif (origin instanceof HTMLElement) {\n\t\t\t\treturn !origin.contains(target);\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":";;;;;;;;MAgBa,eAAe,CAAA;IAI3B,WACU,CAAA,UAAsB,EACd,aAAiC,EACzC,gBAAuC,EAC/B,MAAc,EACd,MAAe,EACf,QAAmB,EAAA;QAL3B,IAAU,CAAA,UAAA,GAAV,UAAU,CAAY;QACd,IAAa,CAAA,aAAA,GAAb,aAAa,CAAoB;QACzC,IAAgB,CAAA,gBAAA,GAAhB,gBAAgB,CAAuB;QAC/B,IAAM,CAAA,MAAA,GAAN,MAAM,CAAQ;QACd,IAAM,CAAA,MAAA,GAAN,MAAM,CAAS;QACf,IAAQ,CAAA,QAAA,GAAR,QAAQ,CAAW;QAT7B,IAAa,CAAA,aAAA,GAAa,IAAI,CAAC;QAC/B,IAAM,CAAA,MAAA,GAAY,IAAI,CAAC;;QAW9B,IAAI,CAAC,SAAS,EAAE;aACd,IAAI,CACJ,SAAS,CAAC,MACT,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,MAAM,IAAI,CAAC,UAAU,CAAC,oBAAoB,EAAE,CAAC,CAC3E,EACD,MAAM,CACL,CAAC,KAAiB,KACjB,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,mBAAmB,IAAI,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAC5E,EACD,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAC9B;aACA,SAAS,CAAC,MAAM,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;;QAGhC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,cAAc,EAAE,OAAO,CAAC;AAChD,aAAA,IAAI,CACJ,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,EACpD,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,EACxC,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,CAC9B;aACA,SAAS,CAAC,MAAM,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;;QAGhC,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,aAAa,CAAC,wBAAwB,EAAE;YAC/D,IAAI,CAAC,MAAM,CAAC,MAAM;AAChB,iBAAA,IAAI,CACJ,MAAM,CAAC,CAAC,KAAY,KAAK,KAAK,YAAY,aAAa,CAAC,EACxD,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,EAC9B,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,CACxC;iBACA,SAAS,CAAC,MAAM,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;SAChC;QAED,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,aAAa,CAAC,mBAAmB,EAAE;AAC5D,YAAA,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC;iBAC1B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,CAAC;iBAC9C,SAAS,CAAC,MAAM,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;SAChC;AAED,QAAA,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,YAAY,EAAE;AACrC,YAAA,KAAK,CACJ,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,EAC/B,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAgB,KAAK,CAAC,CAAC,IAAI,KAAK,QAAQ,CAAC,CAAC,CACvF;AACC,iBAAA,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,CAAC;iBACvD,SAAS,CAAC,MAAM,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;SAChC;;QAGD,MAAM,MAAM,GAAY,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;AAE7D,QAAA,IAAI,MAAM,YAAY,WAAW,EAAE;YAClC,IAAI,CAAC,MAAM,CAAC,QAAQ;AAClB,iBAAA,IAAI,CACJ,YAAY,CAAC,EAAE,CAAC,EAChB,GAAG,CAAC,MAAM,MAAM,CAAC,qBAAqB,EAAE,CAAC,EACzC,QAAQ,EAAE,EACV,MAAM,CACL,CAAC,CAAC,CAAC,EAAE,CAAC,CAAqB,KAC1B,SAAS,CAAC,CAAC,CAAC;gBACZ,SAAS,CAAC,CAAC,CAAC;iBACX,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,MAAM,CAAC,CAC7E,EACD,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,EAC5B,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,CACxC;iBACA,SAAS,CAAC,MAAM,IAAI,CAAC,UAAU,CAAC,cAAc,EAAE,CAAC,CAAC;SACpD;KACD;;IAGD,KAAK,GAAA;AACJ,QAAA,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC;KAC9B;;AAGD,IAAA,IAAI,SAAS,GAAA;AACZ,QAAA,OAAO,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC;KACvC;;AAGD,IAAA,IAAI,QAAQ,GAAA;QACX,OAAO,IAAI,CAAC,MAAM,CAAC;KACnB;;AAGD,IAAA,IAAI,WAAW,GAAA;AACd,QAAA,OAAO,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC;KACrC;AAED;;;AAGG;AACH,IAAA,KAAK,CAAC,WAAe,EAAA;AACpB,QAAA,IAAI,CAAC,aAAa,GAAG,SAAS,CAAC,WAAW,CAAC,GAAG,WAAW,GAAG,IAAI,CAAC;AACjE,QAAA,IAAI,CAAC,UAAU,EAAE,CAAC,SAAS,CAAC,MAAM,KAAK,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,CAAC;AACjE,QAAA,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC;AAC9B,QAAA,IAAI,CAAC,UAAU,CAAC,cAAc,EAAE,CAAC;AACjC,QAAA,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;KACpB;IAED,UAAU,GAAA;AACT,QAAA,OAAO,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC,IAAI,CAC/C,MAAM,CAAC,CAAC,KAAiC,KAAK,KAAK,KAAK,YAAY,CAAC,EACrE,IAAI,CAAC,CAAC,CAAC,EACP,GAAG,CAAC,MAAM,KAAK,CAAC,CAAC,CACjB,CAAC;KACF;IAED,SAAS,GAAA;AACR,QAAA,OAAO,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC,IAAI,CAC/C,MAAM,CAAC,CAAC,KAAiC,KAAK,KAAK,KAAK,WAAW,CAAC,EACpE,IAAI,CAAC,CAAC,CAAC,EACP,GAAG,CAAC,MAAM,KAAK,CAAC,CAAC,CACjB,CAAC;KACF;IAED,WAAW,GAAA;QACV,OAAO,KAAK,CACX,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC,IAAI,CACxC,MAAM,CAAC,CAAC,KAAiC,KAAK,KAAK,KAAK,aAAa,CAAC,CACtE,EACD,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAC7B,CAAC,IAAI,CACL,IAAI,CAAC,CAAC,CAAC,EACP,GAAG,CAAC,MAAM,IAAI,CAAC,aAAa,CAAC,CAC7B,CAAC;KACF;IAED,UAAU,GAAA;QACT,OAAO,KAAK,CACX,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC,IAAI,CACxC,MAAM,CAAC,CAAC,KAAiC,KAAK,KAAK,KAAK,YAAY,CAAC,CACrE,EACD,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAC7B,CAAC,IAAI,CACL,IAAI,CAAC,CAAC,CAAC,EACP,GAAG,CAAC,MAAM,IAAI,CAAC,aAAa,CAAC,CAC7B,CAAC;KACF;IAED,eAAe,GAAA;AACd,QAAA,OAAO,IAAI,CAAC,aAAa,CAAC,gBAAgB,YAAY,iCAAiC;AACtF,cAAE,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,eAAe;cACnD,KAAK,CAAC;KACT;AAEO,IAAA,mBAAmB,CAAC,KAAiB,EAAA;AAC5C,QAAA,MAAM,MAAM,GAAuB,KAAK,CAAC,MAAM,CAAC;AAChD,QAAA,IAAI,MAAM,YAAY,OAAO,EAAE;YAC9B,MAAM,MAAM,GAAY,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;AAC7D,YAAA,IAAI,MAAM,YAAY,WAAW,EAAE;AAClC,gBAAA,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;aAChC;SACD;AACD,QAAA,OAAO,IAAI,CAAC;KACZ;AACD;;AC3LD;;AAEG;;;;"}