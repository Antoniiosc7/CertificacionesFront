import { __decorate, __metadata } from "tslib";
import { CdkOverlayOrigin, FlexibleConnectedPositionStrategy, } from '@angular/cdk/overlay';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, HostBinding, HostListener, Inject, Input, NgZone, Optional, Output, ViewContainerRef, } from '@angular/core';
import { asArray } from '@ng-doc/core/helpers/as-array';
import { dropdownOpenAnimation } from '@ng-doc/ui-kit/animations';
import { NgDocOverlayHost } from '@ng-doc/ui-kit/classes/overlay-host';
import { NgDocOverlayContainerComponent } from '@ng-doc/ui-kit/components/overlay-container';
import { mergeOverlayConfigs, toElement } from '@ng-doc/ui-kit/helpers';
import { ngDocZoneDetach } from '@ng-doc/ui-kit/observables';
import { NgDocOverlayService } from '@ng-doc/ui-kit/services/overlay';
import { NgDocOverlayUtils } from '@ng-doc/ui-kit/utils';
import { UntilDestroy } from '@ngneat/until-destroy';
import * as i0 from "@angular/core";
import * as i1 from "@ng-doc/ui-kit/services/overlay";
import * as i2 from "@ng-doc/ui-kit/classes/overlay-host";
let NgDocDropdownComponent = class NgDocDropdownComponent {
    constructor(changeDetectorRef, overlayService, viewContainerRef, ngZone, overlayHost) {
        this.changeDetectorRef = changeDetectorRef;
        this.overlayService = overlayService;
        this.viewContainerRef = viewContainerRef;
        this.ngZone = ngZone;
        this.overlayHost = overlayHost;
        this.content = '';
        this.origin = null;
        this.closeIfOutsideClick = true;
        this.closeIfInnerClick = false;
        this.withArrow = false;
        this.borderOffset = -8;
        this.panelClass = [];
        this.contactBorder = true;
        this.hasBackdrop = false;
        this.positions = [
            'bottom-center',
            'top-center',
            'right-center',
            'left-center',
        ];
        this.minHeight = '';
        this.maxHeight = '';
        this.height = '';
        this.minWidth = '';
        this.maxWidth = '';
        this.width = '';
        this.beforeOpen = new EventEmitter();
        this.afterOpen = new EventEmitter();
        this.beforeClose = new EventEmitter();
        this.afterClose = new EventEmitter();
        this.overlay = null;
        this.overlayProperties = this.getOverlayProperties();
    }
    ngOnChanges({ origin }) {
        if (origin && origin.currentValue !== origin.previousValue) {
            if (!origin.currentValue) {
                this.origin = origin.previousValue;
            }
            if (this.overlay) {
                const positionStrategy = this.overlay.overlayRef.getConfig().positionStrategy;
                if (positionStrategy instanceof FlexibleConnectedPositionStrategy && this.currentOrigin) {
                    this.overlay.overlayRef.updatePositionStrategy(positionStrategy.setOrigin(this.currentOrigin));
                }
            }
        }
        this.updateOverlayPosition();
    }
    get tabIndex() {
        return this.isOpened ? 0 : -1;
    }
    focus() {
        this.overlay?.focus();
    }
    get isFocused() {
        return !!this.overlay?.isFocused;
    }
    open() {
        if (!this.overlay?.hasAttached) {
            const config = this.getConfig();
            this.overlay = this.overlayService.open(this.content, config);
            this.beforeOpen.emit();
            this.overlay
                ?.afterOpen()
                .pipe(ngDocZoneDetach(this.ngZone))
                .subscribe(() => this.afterOpen.emit());
            this.overlay
                ?.beforeClose()
                .pipe(ngDocZoneDetach(this.ngZone))
                .subscribe(() => this.beforeClose.emit());
            this.overlay
                ?.afterClose()
                .pipe(ngDocZoneDetach(this.ngZone))
                .subscribe(() => this.afterClose.emit());
            this.overlay.beforeClose().subscribe(() => this.close());
            this.changeDetectorRef.markForCheck();
        }
    }
    close() {
        if (this.isOpened) {
            this.overlay?.close();
            this.changeDetectorRef.markForCheck();
        }
    }
    toggle() {
        this.isOpened ? this.close() : this.open();
    }
    get isOpened() {
        return this.overlay?.isOpened === true;
    }
    updateOverlayPosition() {
        if (this.overlay && this.overlay.hasAttached) {
            this.overlay.overlayRef.updateSize(this.getConfig());
            this.overlay.overlayRef.updatePosition();
        }
    }
    get currentOrigin() {
        return this.origin instanceof CdkOverlayOrigin
            ? this.origin.elementRef.nativeElement
            : this.origin || this.overlayHost?.origin || null;
    }
    getPositions(positions, border) {
        const origin = toElement(this.currentOrigin);
        if (origin instanceof HTMLElement) {
            return NgDocOverlayUtils.getConnectedPosition(!!positions && asArray(positions).length
                ? positions
                : ['bottom-center', 'top-center', 'right-center', 'left-center'], origin, border * -1, this.withArrow);
        }
        else {
            return !!positions && asArray(positions).length
                ? asArray(positions)
                : ['bottom-center', 'top-center', 'right-center', 'left-center'];
        }
    }
    getConfig() {
        const overlayProperties = mergeOverlayConfigs(this.overlayProperties, this.getOverlayProperties(), this.overlayHost);
        if (!this.currentOrigin) {
            throw new Error('Origin for the dropdown was not provided.');
        }
        return {
            overlayContainer: NgDocOverlayContainerComponent,
            positionStrategy: this.overlayService.connectedPositionStrategy(this.currentOrigin, this.getPositions(overlayProperties.positions || [], overlayProperties.borderOffset || 0)),
            scrollStrategy: this.overlayService.scrollStrategy().reposition(),
            viewContainerRef: this.viewContainerRef,
            openAnimation: dropdownOpenAnimation,
            hasBackdrop: this.hasBackdrop,
            ...overlayProperties,
            panelClass: [
                'ng-doc-dropdown',
                ...asArray(this.panelClass),
                ...asArray(this.overlayHost?.panelClass),
            ],
        };
    }
    getOverlayProperties() {
        return {
            origin: this.currentOrigin || undefined,
            positions: this.positions,
            closeIfOutsideClick: this.closeIfOutsideClick,
            closeIfInnerClick: this.closeIfInnerClick,
            withPointer: this.withArrow,
            contactBorder: this.contactBorder,
            borderOffset: this.borderOffset,
            panelClass: this.panelClass,
            width: this.width,
            height: this.height,
            minWidth: this.minWidth,
            minHeight: this.minHeight,
            maxWidth: this.maxWidth,
            maxHeight: this.maxHeight,
            disposeOnNavigation: true,
            disposeOnRouteNavigation: true,
        };
    }
    ngOnDestroy() {
        if (this.overlay) {
            this.overlay.overlayRef.dispose();
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: NgDocDropdownComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.NgDocOverlayService }, { token: i0.ViewContainerRef }, { token: i0.NgZone }, { token: NgDocOverlayHost, optional: true }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.1.0", type: NgDocDropdownComponent, isStandalone: true, selector: "ng-doc-dropdown", inputs: { content: "content", origin: "origin", closeIfOutsideClick: "closeIfOutsideClick", closeIfInnerClick: "closeIfInnerClick", withArrow: "withArrow", borderOffset: "borderOffset", panelClass: "panelClass", contactBorder: "contactBorder", hasBackdrop: "hasBackdrop", positions: "positions", minHeight: "minHeight", maxHeight: "maxHeight", height: "height", minWidth: "minWidth", maxWidth: "maxWidth", width: "width" }, outputs: { beforeOpen: "beforeOpen", afterOpen: "afterOpen", beforeClose: "beforeClose", afterClose: "afterClose" }, host: { listeners: { "focus": "focus()" }, properties: { "attr.tabIndex": "this.tabIndex" } }, providers: [NgDocOverlayService], usesOnChanges: true, ngImport: i0, template: ``, isInline: true, styles: ["::ng-deep .ng-doc-dropdown{--ng-doc-overlay-background: var(--ng-doc-background);--ng-doc-overlay-border: var(--ng-doc-base-2);--ng-doc-overlay-border-radius: var(--ng-doc-base-gutter);--ng-doc-overlay-shadow: 0px 12px 16px -4px rgba(16, 24, 40, .08), 0px 4px 6px -2px rgba(16, 24, 40, .03)}\n"], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
};
NgDocDropdownComponent = __decorate([
    UntilDestroy(),
    __metadata("design:paramtypes", [ChangeDetectorRef,
        NgDocOverlayService,
        ViewContainerRef,
        NgZone,
        NgDocOverlayHost])
], NgDocDropdownComponent);
export { NgDocDropdownComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: NgDocDropdownComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ng-doc-dropdown', template: ``, changeDetection: ChangeDetectionStrategy.OnPush, providers: [NgDocOverlayService], standalone: true, styles: ["::ng-deep .ng-doc-dropdown{--ng-doc-overlay-background: var(--ng-doc-background);--ng-doc-overlay-border: var(--ng-doc-base-2);--ng-doc-overlay-border-radius: var(--ng-doc-base-gutter);--ng-doc-overlay-shadow: 0px 12px 16px -4px rgba(16, 24, 40, .08), 0px 4px 6px -2px rgba(16, 24, 40, .03)}\n"] }]
        }], ctorParameters: () => [{ type: i0.ChangeDetectorRef }, { type: i1.NgDocOverlayService }, { type: i0.ViewContainerRef }, { type: i0.NgZone }, { type: i2.NgDocOverlayHost, decorators: [{
                    type: Inject,
                    args: [NgDocOverlayHost]
                }, {
                    type: Optional
                }] }], propDecorators: { content: [{
                type: Input
            }], origin: [{
                type: Input
            }], closeIfOutsideClick: [{
                type: Input
            }], closeIfInnerClick: [{
                type: Input
            }], withArrow: [{
                type: Input
            }], borderOffset: [{
                type: Input
            }], panelClass: [{
                type: Input
            }], contactBorder: [{
                type: Input
            }], hasBackdrop: [{
                type: Input
            }], positions: [{
                type: Input
            }], minHeight: [{
                type: Input
            }], maxHeight: [{
                type: Input
            }], height: [{
                type: Input
            }], minWidth: [{
                type: Input
            }], maxWidth: [{
                type: Input
            }], width: [{
                type: Input
            }], beforeOpen: [{
                type: Output
            }], afterOpen: [{
                type: Output
            }], beforeClose: [{
                type: Output
            }], afterClose: [{
                type: Output
            }], tabIndex: [{
                type: HostBinding,
                args: ['attr.tabIndex']
            }], focus: [{
                type: HostListener,
                args: ['focus']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy91aS1raXQvY29tcG9uZW50cy9kcm9wZG93bi9kcm9wZG93bi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE9BQU8sRUFDTixnQkFBZ0IsRUFDaEIsaUNBQWlDLEdBRWpDLE1BQU0sc0JBQXNCLENBQUM7QUFDOUIsT0FBTyxFQUNOLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixXQUFXLEVBQ1gsWUFBWSxFQUNaLE1BQU0sRUFDTixLQUFLLEVBQ0wsTUFBTSxFQUdOLFFBQVEsRUFDUixNQUFNLEVBRU4sZ0JBQWdCLEdBQ2hCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUN4RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUV2RSxPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQztBQUM3RixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsU0FBUyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFeEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzdELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBRXRFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7OztBQVc5QyxJQUFNLHNCQUFzQixHQUE1QixNQUFNLHNCQUFzQjtJQXFFbEMsWUFDVyxpQkFBb0MsRUFDcEMsY0FBbUMsRUFDbkMsZ0JBQWtDLEVBQ2xDLE1BQWMsRUFHZCxXQUE4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Z0JBQWdCO1FBQzFCLE1BQU07UUFHQSxnQkFBZ0I7R0E1RTdCLHNCQUFzQixDQWlQbEM7OzJGQWpQWSxzQkFBc0I7a0JBVGxDLFNBQVM7K0JBQ0MsaUJBQWlCLFlBQ2pCLEVBQUUsbUJBRUssdUJBQXVCLENBQUMsTUFBTSxhQUNwQyxDQUFDLG1CQUFtQixDQUFDLGNBQ3BCLElBQUk7OzBCQTZFZCxNQUFNOzJCQUFDLGdCQUFnQjs7MEJBQ3ZCLFFBQVE7eUNBekVWLE9BQU87c0JBRE4sS0FBSztnQkFJTixNQUFNO3NCQURMLEtBQUs7Z0JBSU4sbUJBQW1CO3NCQURsQixLQUFLO2dCQUlOLGlCQUFpQjtzQkFEaEIsS0FBSztnQkFJTixTQUFTO3NCQURSLEtBQUs7Z0JBSU4sWUFBWTtzQkFEWCxLQUFLO2dCQUlOLFVBQVU7c0JBRFQsS0FBSztnQkFJTixhQUFhO3NCQURaLEtBQUs7Z0JBSU4sV0FBVztzQkFEVixLQUFLO2dCQUlOLFNBQVM7c0JBRFIsS0FBSztnQkFTTixTQUFTO3NCQURSLEtBQUs7Z0JBSU4sU0FBUztzQkFEUixLQUFLO2dCQUlOLE1BQU07c0JBREwsS0FBSztnQkFJTixRQUFRO3NCQURQLEtBQUs7Z0JBSU4sUUFBUTtzQkFEUCxLQUFLO2dCQUlOLEtBQUs7c0JBREosS0FBSztnQkFJTixVQUFVO3NCQURULE1BQU07Z0JBSVAsU0FBUztzQkFEUixNQUFNO2dCQUlQLFdBQVc7c0JBRFYsTUFBTTtnQkFJUCxVQUFVO3NCQURULE1BQU07Z0JBb0NILFFBQVE7c0JBRFgsV0FBVzt1QkFBQyxlQUFlO2dCQU01QixLQUFLO3NCQURKLFlBQVk7dUJBQUMsT0FBTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBvaW50IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2RyYWctZHJvcCc7XG5pbXBvcnQge1xuXHRDZGtPdmVybGF5T3JpZ2luLFxuXHRGbGV4aWJsZUNvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3ksXG5cdFBvc2l0aW9uU3RyYXRlZ3ksXG59IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcbmltcG9ydCB7XG5cdENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuXHRDaGFuZ2VEZXRlY3RvclJlZixcblx0Q29tcG9uZW50LFxuXHRFdmVudEVtaXR0ZXIsXG5cdEhvc3RCaW5kaW5nLFxuXHRIb3N0TGlzdGVuZXIsXG5cdEluamVjdCxcblx0SW5wdXQsXG5cdE5nWm9uZSxcblx0T25DaGFuZ2VzLFxuXHRPbkRlc3Ryb3ksXG5cdE9wdGlvbmFsLFxuXHRPdXRwdXQsXG5cdFNpbXBsZUNoYW5nZXMsXG5cdFZpZXdDb250YWluZXJSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgYXNBcnJheSB9IGZyb20gJ0BuZy1kb2MvY29yZS9oZWxwZXJzL2FzLWFycmF5JztcbmltcG9ydCB7IGRyb3Bkb3duT3BlbkFuaW1hdGlvbiB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgTmdEb2NPdmVybGF5SG9zdCB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L2NsYXNzZXMvb3ZlcmxheS1ob3N0JztcbmltcG9ydCB7IE5nRG9jT3ZlcmxheVJlZiB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L2NsYXNzZXMvb3ZlcmxheS1yZWYnO1xuaW1wb3J0IHsgTmdEb2NPdmVybGF5Q29udGFpbmVyQ29tcG9uZW50IH0gZnJvbSAnQG5nLWRvYy91aS1raXQvY29tcG9uZW50cy9vdmVybGF5LWNvbnRhaW5lcic7XG5pbXBvcnQgeyBtZXJnZU92ZXJsYXlDb25maWdzLCB0b0VsZW1lbnQgfSBmcm9tICdAbmctZG9jL3VpLWtpdC9oZWxwZXJzJztcbmltcG9ydCB7IE5nRG9jT3ZlcmxheUNvbmZpZywgTmdEb2NPdmVybGF5UHJvcGVydGllcyB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgbmdEb2Nab25lRGV0YWNoIH0gZnJvbSAnQG5nLWRvYy91aS1raXQvb2JzZXJ2YWJsZXMnO1xuaW1wb3J0IHsgTmdEb2NPdmVybGF5U2VydmljZSB9IGZyb20gJ0BuZy1kb2MvdWkta2l0L3NlcnZpY2VzL292ZXJsYXknO1xuaW1wb3J0IHsgTmdEb2NDb250ZW50LCBOZ0RvY092ZXJsYXlPcmlnaW4sIE5nRG9jT3ZlcmxheVBvc2l0aW9uIH0gZnJvbSAnQG5nLWRvYy91aS1raXQvdHlwZXMnO1xuaW1wb3J0IHsgTmdEb2NPdmVybGF5VXRpbHMgfSBmcm9tICdAbmctZG9jL3VpLWtpdC91dGlscyc7XG5pbXBvcnQgeyBVbnRpbERlc3Ryb3kgfSBmcm9tICdAbmduZWF0L3VudGlsLWRlc3Ryb3knO1xuXG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6ICduZy1kb2MtZHJvcGRvd24nLFxuXHR0ZW1wbGF0ZTogYGAsXG5cdHN0eWxlVXJsczogWycuL2Ryb3Bkb3duLmNvbXBvbmVudC5zY3NzJ10sXG5cdGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuXHRwcm92aWRlcnM6IFtOZ0RvY092ZXJsYXlTZXJ2aWNlXSxcblx0c3RhbmRhbG9uZTogdHJ1ZSxcbn0pXG5AVW50aWxEZXN0cm95KClcbmV4cG9ydCBjbGFzcyBOZ0RvY0Ryb3Bkb3duQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuXHRASW5wdXQoKVxuXHRjb250ZW50OiBOZ0RvY0NvbnRlbnQgPSAnJztcblxuXHRASW5wdXQoKVxuXHRvcmlnaW46IENka092ZXJsYXlPcmlnaW4gfCBQb2ludCB8IG51bGwgPSBudWxsO1xuXG5cdEBJbnB1dCgpXG5cdGNsb3NlSWZPdXRzaWRlQ2xpY2s6IGJvb2xlYW4gPSB0cnVlO1xuXG5cdEBJbnB1dCgpXG5cdGNsb3NlSWZJbm5lckNsaWNrOiBib29sZWFuID0gZmFsc2U7XG5cblx0QElucHV0KClcblx0d2l0aEFycm93OiBib29sZWFuID0gZmFsc2U7XG5cblx0QElucHV0KClcblx0Ym9yZGVyT2Zmc2V0OiBudW1iZXIgPSAtODtcblxuXHRASW5wdXQoKVxuXHRwYW5lbENsYXNzOiBzdHJpbmcgfCBzdHJpbmdbXSA9IFtdO1xuXG5cdEBJbnB1dCgpXG5cdGNvbnRhY3RCb3JkZXI6IGJvb2xlYW4gPSB0cnVlO1xuXG5cdEBJbnB1dCgpXG5cdGhhc0JhY2tkcm9wOiBib29sZWFuID0gZmFsc2U7XG5cblx0QElucHV0KClcblx0cG9zaXRpb25zOiBOZ0RvY092ZXJsYXlQb3NpdGlvbiB8IE5nRG9jT3ZlcmxheVBvc2l0aW9uW10gPSBbXG5cdFx0J2JvdHRvbS1jZW50ZXInLFxuXHRcdCd0b3AtY2VudGVyJyxcblx0XHQncmlnaHQtY2VudGVyJyxcblx0XHQnbGVmdC1jZW50ZXInLFxuXHRdO1xuXG5cdEBJbnB1dCgpXG5cdG1pbkhlaWdodDogbnVtYmVyIHwgc3RyaW5nID0gJyc7XG5cblx0QElucHV0KClcblx0bWF4SGVpZ2h0OiBudW1iZXIgfCBzdHJpbmcgPSAnJztcblxuXHRASW5wdXQoKVxuXHRoZWlnaHQ6IG51bWJlciB8IHN0cmluZyA9ICcnO1xuXG5cdEBJbnB1dCgpXG5cdG1pbldpZHRoOiBudW1iZXIgfCBzdHJpbmcgPSAnJztcblxuXHRASW5wdXQoKVxuXHRtYXhXaWR0aDogbnVtYmVyIHwgc3RyaW5nID0gJyc7XG5cblx0QElucHV0KClcblx0d2lkdGg6IG51bWJlciB8IHN0cmluZyA9ICcnO1xuXG5cdEBPdXRwdXQoKVxuXHRiZWZvcmVPcGVuOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cblx0QE91dHB1dCgpXG5cdGFmdGVyT3BlbjogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG5cdEBPdXRwdXQoKVxuXHRiZWZvcmVDbG9zZTogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG5cdEBPdXRwdXQoKVxuXHRhZnRlckNsb3NlOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cblx0b3ZlcmxheTogTmdEb2NPdmVybGF5UmVmIHwgbnVsbCA9IG51bGw7XG5cdG92ZXJsYXlQcm9wZXJ0aWVzOiBOZ0RvY092ZXJsYXlQcm9wZXJ0aWVzID0gdGhpcy5nZXRPdmVybGF5UHJvcGVydGllcygpO1xuXG5cdGNvbnN0cnVjdG9yKFxuXHRcdHByb3RlY3RlZCBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG5cdFx0cHJvdGVjdGVkIG92ZXJsYXlTZXJ2aWNlOiBOZ0RvY092ZXJsYXlTZXJ2aWNlLFxuXHRcdHByb3RlY3RlZCB2aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmLFxuXHRcdHByb3RlY3RlZCBuZ1pvbmU6IE5nWm9uZSxcblx0XHRASW5qZWN0KE5nRG9jT3ZlcmxheUhvc3QpXG5cdFx0QE9wdGlvbmFsKClcblx0XHRwcm90ZWN0ZWQgb3ZlcmxheUhvc3Q/OiBOZ0RvY092ZXJsYXlIb3N0LFxuXHQpIHt9XG5cblx0bmdPbkNoYW5nZXMoeyBvcmlnaW4gfTogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuXHRcdGlmIChvcmlnaW4gJiYgb3JpZ2luLmN1cnJlbnRWYWx1ZSAhPT0gb3JpZ2luLnByZXZpb3VzVmFsdWUpIHtcblx0XHRcdGlmICghb3JpZ2luLmN1cnJlbnRWYWx1ZSkge1xuXHRcdFx0XHR0aGlzLm9yaWdpbiA9IG9yaWdpbi5wcmV2aW91c1ZhbHVlIGFzIENka092ZXJsYXlPcmlnaW4gfCBQb2ludCB8IG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLm92ZXJsYXkpIHtcblx0XHRcdFx0Y29uc3QgcG9zaXRpb25TdHJhdGVneTogUG9zaXRpb25TdHJhdGVneSB8IHVuZGVmaW5lZCA9XG5cdFx0XHRcdFx0dGhpcy5vdmVybGF5Lm92ZXJsYXlSZWYuZ2V0Q29uZmlnKCkucG9zaXRpb25TdHJhdGVneTtcblx0XHRcdFx0aWYgKHBvc2l0aW9uU3RyYXRlZ3kgaW5zdGFuY2VvZiBGbGV4aWJsZUNvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3kgJiYgdGhpcy5jdXJyZW50T3JpZ2luKSB7XG5cdFx0XHRcdFx0dGhpcy5vdmVybGF5Lm92ZXJsYXlSZWYudXBkYXRlUG9zaXRpb25TdHJhdGVneShcblx0XHRcdFx0XHRcdHBvc2l0aW9uU3RyYXRlZ3kuc2V0T3JpZ2luKHRoaXMuY3VycmVudE9yaWdpbiksXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHR0aGlzLnVwZGF0ZU92ZXJsYXlQb3NpdGlvbigpO1xuXHR9XG5cblx0QEhvc3RCaW5kaW5nKCdhdHRyLnRhYkluZGV4Jylcblx0Z2V0IHRhYkluZGV4KCk6IG51bWJlciB7XG5cdFx0cmV0dXJuIHRoaXMuaXNPcGVuZWQgPyAwIDogLTE7XG5cdH1cblxuXHRASG9zdExpc3RlbmVyKCdmb2N1cycpXG5cdGZvY3VzKCk6IHZvaWQge1xuXHRcdHRoaXMub3ZlcmxheT8uZm9jdXMoKTtcblx0fVxuXG5cdGdldCBpc0ZvY3VzZWQoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuICEhdGhpcy5vdmVybGF5Py5pc0ZvY3VzZWQ7XG5cdH1cblxuXHRvcGVuKCk6IHZvaWQge1xuXHRcdGlmICghdGhpcy5vdmVybGF5Py5oYXNBdHRhY2hlZCkge1xuXHRcdFx0Y29uc3QgY29uZmlnOiBOZ0RvY092ZXJsYXlDb25maWcgPSB0aGlzLmdldENvbmZpZygpO1xuXHRcdFx0dGhpcy5vdmVybGF5ID0gdGhpcy5vdmVybGF5U2VydmljZS5vcGVuKHRoaXMuY29udGVudCwgY29uZmlnKTtcblx0XHRcdHRoaXMuYmVmb3JlT3Blbi5lbWl0KCk7XG5cdFx0XHR0aGlzLm92ZXJsYXlcblx0XHRcdFx0Py5hZnRlck9wZW4oKVxuXHRcdFx0XHQucGlwZShuZ0RvY1pvbmVEZXRhY2godGhpcy5uZ1pvbmUpKVxuXHRcdFx0XHQuc3Vic2NyaWJlKCgpID0+IHRoaXMuYWZ0ZXJPcGVuLmVtaXQoKSk7XG5cblx0XHRcdHRoaXMub3ZlcmxheVxuXHRcdFx0XHQ/LmJlZm9yZUNsb3NlKClcblx0XHRcdFx0LnBpcGUobmdEb2Nab25lRGV0YWNoKHRoaXMubmdab25lKSlcblx0XHRcdFx0LnN1YnNjcmliZSgoKSA9PiB0aGlzLmJlZm9yZUNsb3NlLmVtaXQoKSk7XG5cblx0XHRcdHRoaXMub3ZlcmxheVxuXHRcdFx0XHQ/LmFmdGVyQ2xvc2UoKVxuXHRcdFx0XHQucGlwZShuZ0RvY1pvbmVEZXRhY2godGhpcy5uZ1pvbmUpKVxuXHRcdFx0XHQuc3Vic2NyaWJlKCgpID0+IHRoaXMuYWZ0ZXJDbG9zZS5lbWl0KCkpO1xuXG5cdFx0XHR0aGlzLm92ZXJsYXkuYmVmb3JlQ2xvc2UoKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5jbG9zZSgpKTtcblxuXHRcdFx0dGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcblx0XHR9XG5cdH1cblxuXHRjbG9zZSgpOiB2b2lkIHtcblx0XHRpZiAodGhpcy5pc09wZW5lZCkge1xuXHRcdFx0dGhpcy5vdmVybGF5Py5jbG9zZSgpO1xuXHRcdFx0dGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcblx0XHR9XG5cdH1cblxuXHR0b2dnbGUoKTogdm9pZCB7XG5cdFx0dGhpcy5pc09wZW5lZCA/IHRoaXMuY2xvc2UoKSA6IHRoaXMub3BlbigpO1xuXHR9XG5cblx0Z2V0IGlzT3BlbmVkKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLm92ZXJsYXk/LmlzT3BlbmVkID09PSB0cnVlO1xuXHR9XG5cblx0dXBkYXRlT3ZlcmxheVBvc2l0aW9uKCk6IHZvaWQge1xuXHRcdGlmICh0aGlzLm92ZXJsYXkgJiYgdGhpcy5vdmVybGF5Lmhhc0F0dGFjaGVkKSB7XG5cdFx0XHR0aGlzLm92ZXJsYXkub3ZlcmxheVJlZi51cGRhdGVTaXplKHRoaXMuZ2V0Q29uZmlnKCkpO1xuXHRcdFx0dGhpcy5vdmVybGF5Lm92ZXJsYXlSZWYudXBkYXRlUG9zaXRpb24oKTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGdldCBjdXJyZW50T3JpZ2luKCk6IE5nRG9jT3ZlcmxheU9yaWdpbiB8IG51bGwge1xuXHRcdHJldHVybiB0aGlzLm9yaWdpbiBpbnN0YW5jZW9mIENka092ZXJsYXlPcmlnaW5cblx0XHRcdD8gKHRoaXMub3JpZ2luLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCBhcyBIVE1MRWxlbWVudClcblx0XHRcdDogdGhpcy5vcmlnaW4gfHwgdGhpcy5vdmVybGF5SG9zdD8ub3JpZ2luIHx8IG51bGw7XG5cdH1cblxuXHRwcml2YXRlIGdldFBvc2l0aW9ucyhcblx0XHRwb3NpdGlvbnM6IE5nRG9jT3ZlcmxheVBvc2l0aW9uIHwgTmdEb2NPdmVybGF5UG9zaXRpb25bXSxcblx0XHRib3JkZXI6IG51bWJlcixcblx0KTogTmdEb2NPdmVybGF5UG9zaXRpb25bXSB7XG5cdFx0Y29uc3Qgb3JpZ2luOiBOZ0RvY092ZXJsYXlPcmlnaW4gPSB0b0VsZW1lbnQodGhpcy5jdXJyZW50T3JpZ2luKSBhcyBIVE1MRWxlbWVudDtcblx0XHRpZiAob3JpZ2luIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcblx0XHRcdHJldHVybiBOZ0RvY092ZXJsYXlVdGlscy5nZXRDb25uZWN0ZWRQb3NpdGlvbihcblx0XHRcdFx0ISFwb3NpdGlvbnMgJiYgYXNBcnJheShwb3NpdGlvbnMpLmxlbmd0aFxuXHRcdFx0XHRcdD8gcG9zaXRpb25zXG5cdFx0XHRcdFx0OiBbJ2JvdHRvbS1jZW50ZXInLCAndG9wLWNlbnRlcicsICdyaWdodC1jZW50ZXInLCAnbGVmdC1jZW50ZXInXSxcblx0XHRcdFx0b3JpZ2luLFxuXHRcdFx0XHRib3JkZXIgKiAtMSxcblx0XHRcdFx0dGhpcy53aXRoQXJyb3csXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gISFwb3NpdGlvbnMgJiYgYXNBcnJheShwb3NpdGlvbnMpLmxlbmd0aFxuXHRcdFx0XHQ/IGFzQXJyYXkocG9zaXRpb25zKVxuXHRcdFx0XHQ6IFsnYm90dG9tLWNlbnRlcicsICd0b3AtY2VudGVyJywgJ3JpZ2h0LWNlbnRlcicsICdsZWZ0LWNlbnRlciddO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgZ2V0Q29uZmlnKCk6IE5nRG9jT3ZlcmxheUNvbmZpZyB7XG5cdFx0Y29uc3Qgb3ZlcmxheVByb3BlcnRpZXM6IE5nRG9jT3ZlcmxheVByb3BlcnRpZXMgPSBtZXJnZU92ZXJsYXlDb25maWdzKFxuXHRcdFx0dGhpcy5vdmVybGF5UHJvcGVydGllcyxcblx0XHRcdHRoaXMuZ2V0T3ZlcmxheVByb3BlcnRpZXMoKSxcblx0XHRcdHRoaXMub3ZlcmxheUhvc3QsXG5cdFx0KTtcblx0XHRpZiAoIXRoaXMuY3VycmVudE9yaWdpbikge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdPcmlnaW4gZm9yIHRoZSBkcm9wZG93biB3YXMgbm90IHByb3ZpZGVkLicpO1xuXHRcdH1cblx0XHRyZXR1cm4ge1xuXHRcdFx0b3ZlcmxheUNvbnRhaW5lcjogTmdEb2NPdmVybGF5Q29udGFpbmVyQ29tcG9uZW50LFxuXHRcdFx0cG9zaXRpb25TdHJhdGVneTogdGhpcy5vdmVybGF5U2VydmljZS5jb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5KFxuXHRcdFx0XHR0aGlzLmN1cnJlbnRPcmlnaW4sXG5cdFx0XHRcdHRoaXMuZ2V0UG9zaXRpb25zKG92ZXJsYXlQcm9wZXJ0aWVzLnBvc2l0aW9ucyB8fCBbXSwgb3ZlcmxheVByb3BlcnRpZXMuYm9yZGVyT2Zmc2V0IHx8IDApLFxuXHRcdFx0KSxcblx0XHRcdHNjcm9sbFN0cmF0ZWd5OiB0aGlzLm92ZXJsYXlTZXJ2aWNlLnNjcm9sbFN0cmF0ZWd5KCkucmVwb3NpdGlvbigpLFxuXHRcdFx0dmlld0NvbnRhaW5lclJlZjogdGhpcy52aWV3Q29udGFpbmVyUmVmLFxuXHRcdFx0b3BlbkFuaW1hdGlvbjogZHJvcGRvd25PcGVuQW5pbWF0aW9uLFxuXHRcdFx0aGFzQmFja2Ryb3A6IHRoaXMuaGFzQmFja2Ryb3AsXG5cdFx0XHQuLi5vdmVybGF5UHJvcGVydGllcyxcblx0XHRcdHBhbmVsQ2xhc3M6IFtcblx0XHRcdFx0J25nLWRvYy1kcm9wZG93bicsXG5cdFx0XHRcdC4uLmFzQXJyYXkodGhpcy5wYW5lbENsYXNzKSxcblx0XHRcdFx0Li4uYXNBcnJheSh0aGlzLm92ZXJsYXlIb3N0Py5wYW5lbENsYXNzKSxcblx0XHRcdF0sXG5cdFx0fTtcblx0fVxuXG5cdHByaXZhdGUgZ2V0T3ZlcmxheVByb3BlcnRpZXMoKTogTmdEb2NPdmVybGF5UHJvcGVydGllcyB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdG9yaWdpbjogdGhpcy5jdXJyZW50T3JpZ2luIHx8IHVuZGVmaW5lZCxcblx0XHRcdHBvc2l0aW9uczogdGhpcy5wb3NpdGlvbnMsXG5cdFx0XHRjbG9zZUlmT3V0c2lkZUNsaWNrOiB0aGlzLmNsb3NlSWZPdXRzaWRlQ2xpY2ssXG5cdFx0XHRjbG9zZUlmSW5uZXJDbGljazogdGhpcy5jbG9zZUlmSW5uZXJDbGljayxcblx0XHRcdHdpdGhQb2ludGVyOiB0aGlzLndpdGhBcnJvdyxcblx0XHRcdGNvbnRhY3RCb3JkZXI6IHRoaXMuY29udGFjdEJvcmRlcixcblx0XHRcdGJvcmRlck9mZnNldDogdGhpcy5ib3JkZXJPZmZzZXQsXG5cdFx0XHRwYW5lbENsYXNzOiB0aGlzLnBhbmVsQ2xhc3MsXG5cdFx0XHR3aWR0aDogdGhpcy53aWR0aCxcblx0XHRcdGhlaWdodDogdGhpcy5oZWlnaHQsXG5cdFx0XHRtaW5XaWR0aDogdGhpcy5taW5XaWR0aCxcblx0XHRcdG1pbkhlaWdodDogdGhpcy5taW5IZWlnaHQsXG5cdFx0XHRtYXhXaWR0aDogdGhpcy5tYXhXaWR0aCxcblx0XHRcdG1heEhlaWdodDogdGhpcy5tYXhIZWlnaHQsXG5cdFx0XHRkaXNwb3NlT25OYXZpZ2F0aW9uOiB0cnVlLFxuXHRcdFx0ZGlzcG9zZU9uUm91dGVOYXZpZ2F0aW9uOiB0cnVlLFxuXHRcdH07XG5cdH1cblxuXHRuZ09uRGVzdHJveSgpOiB2b2lkIHtcblx0XHRpZiAodGhpcy5vdmVybGF5KSB7XG5cdFx0XHR0aGlzLm92ZXJsYXkub3ZlcmxheVJlZi5kaXNwb3NlKCk7XG5cdFx0fVxuXHR9XG59XG4iXX0=