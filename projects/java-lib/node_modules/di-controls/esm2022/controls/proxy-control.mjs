import { Directive } from '@angular/core';
import { DIControl } from './control';
import * as i0 from "@angular/core";
/**
 * `DIProxyControl` is very suitable.
 * It is typically used as a host and works exclusively with objects. It is
 * necessary to bind child controls to a specific property of the object,
 * thereby ensuring that they update only that specific property and not the
 * entire object as a whole. Please see `*DateRangePage`.
 *
 * ## Creating a control
 * To create a control you need to extend your `@Component` or `@Directive` from `DIProxyControl` class
 * and provide `getValue` and `setValue` functions that will be used to get and set value from the object
 * to the child control.
 *
 * ```ts fileName="custom-control.component.ts"
 * @Component({})
 * export class CustomControlComponent extends DIProxyControl<MyObject> {
 *   constructor() {
 *    super({
 *      getValue: (model) => model.objectProperty,
 *      setValue: (model, value) => ({...model, objectProperty: value}),
 *    });
 *  }
 * }
 *  ```
 *
 * ## Registering as a host
 * By default your control can work only with `NgModel` and `FormControl`. But you can register your control as a host
 * for another controls, then your control will be able to update them and accept updates from them. To do that you need to
 * use `provideHostControl` function.
 *
 * ```ts {2} fileName="custom-control.component.ts"
 * @Component({
 *   providers: [provideHostControl(CustomControlComponent)],
 * })
 * export class CustomControlComponent extends DIProxyControl<MyObject> {
 *   constructor() {
 *     super({
 *      getValue: (model) => model.objectProperty,
 *      setValue: (model, value) => ({...model, objectProperty: value}),
 *    });
 *   }
 * }
 * ```
 *
 * ## Injecting host control
 * By default your control doesn't communicate with host controls. But you can inject host control and put it
 * into `super` call. This will register your control in the host control and start communication between them.
 *
 * > **Note**
 * > If you register your control as a host for another controls, then you can inject it
 * > only with `skipSelf` option.
 *
 * ```ts {5} fileName="custom-control.component.ts"
 * @Component({})
 * export class CustomControlComponent extends DIProxyControl<MyObject> {
 *   constructor() {
 *     // we add `optional` option to make it possible to use this control without host
 *     super({
 *       host: injectHostControl({optional: true}),
 *       getValue: (model) => model.objectProperty,
 *       setValue: (model, value) => ({...model, objectProperty: value}),
 *     });
 *   }
 * }
 * ```
 *
 * ## Getting model
 * To get model you need to use `model` property. It will return model for the current control.
 *
 * ```ts {9} fileName="custom-control.component.ts"
 * @Component({})
 * export class CustomControlComponent extends DIProxyControl<MyObject> {
 *   constructor() {
 *     super(
 *       getValue: (model) => model.objectProperty,
 *       setValue: (model, value) => ({...model, objectProperty: value}),
 *     );
 *   }
 *
 *   @HostListener('click')
 *   onClick() {
 *     console.log(this.model());
 *   }
 * }
 * ```
 *
 * ## Updating model
 * To update model you need to call `updateModel` method. It will update model for the current control and all
 * children controls, as well as for the `NgModel` or `FormControl`.
 *
 * ```ts {9} fileName="custom-control.component.ts"
 * @Component({})
 * export class CustomControlComponent extends DIProxyControl<MyObject> {
 *   constructor() {
 *     super(
 *       getValue: (model) => model.objectProperty,
 *       setValue: (model, value) => ({...model, objectProperty: value}),
 *     );
 *   }
 *
 *   @HostListener('click')
 *   onClick() {
 *     this.updateModel({objectProperty: 'new value'});
 *   }
 * }
 * ```
 * ## Catching updates
 * Sometimes you may need to catch updates from different sources. For example, to update the value of the native
 * input element. To do this, you can provide the `onIncomingUpdate` hook.
 *
 * ```ts {6} fileName="custom-control.component.ts"
 * @Component({})
 * export class CustomControlComponent extends DIProxyControl<MyObject> {
 *   constructor() {
 *     super({
 *       onIncomingUpdate: (value: MyObject | null) => {
 *         this.elementRef.nativeElement.value = value;
 *       },
 *     });
 *   }
 * }
 * ```
 */
class DIProxyControl extends DIControl {
    config;
    constructor(config) {
        super(config);
        this.config = config;
    }
    registerControl(control) {
        this.children.add(control);
        /*
         * We have to update control because its can be created dynamically.
         * We use Promise.resolve because NgModel uses it too to set first value (https://github.com/angular/angular/blob/7df9127088bda3c9d29937a04287b87dc2045ea7/packages/forms/src/directives/ng_model.ts#L314)
         * so there's no need to use angular life cycle hooks
         */
        Promise.resolve().then(() => control.writeValueFromHost(this.config.getValue(this.model())));
        control.registerOnControlChange((value) => {
            this.updateFrom = control;
            this.updateModel(this.config.setValue(this.model(), value));
        });
        control.registerRequestForUpdate(() => {
            control.writeValueFromHost(this.config.getValue(this.model()));
        });
    }
    updateControl(control, value) {
        control.writeValueFromHost(this.config.getValue(value));
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.0", ngImport: i0, type: DIProxyControl, deps: "invalid", target: i0.ɵɵFactoryTarget.Directive });
    static ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.0.0", type: DIProxyControl, usesInheritance: true, ngImport: i0 });
}
export { DIProxyControl };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.0", ngImport: i0, type: DIProxyControl, decorators: [{
            type: Directive
        }], ctorParameters: function () { return [{ type: undefined }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJveHktY29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2xpYnMvZGktY29udHJvbHMvY29udHJvbHMvcHJveHktY29udHJvbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRXhDLE9BQU8sRUFBQyxTQUFTLEVBQWtCLE1BQU0sV0FBVyxDQUFDOztBQWlCckQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F5SEc7QUFDSCxNQUNzQixjQUFvQyxTQUFRLFNBQThCO0lBRTNFO0lBRHBCLFlBQ29CLE1BQWlEO1FBRXBFLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUZLLFdBQU0sR0FBTixNQUFNLENBQTJDO0lBR3JFLENBQUM7SUFFUSxlQUFlLENBQUMsT0FBK0I7UUFDdkQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFM0I7Ozs7V0FJRztRQUNILE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUU3RixPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxLQUF5QixFQUFFLEVBQUU7WUFDN0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUM7WUFDMUIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxHQUFHLEVBQUU7WUFDckMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDaEUsQ0FBQyxDQUFDLENBQUM7SUFDSixDQUFDO0lBRWtCLGFBQWEsQ0FBQyxPQUErQixFQUFFLEtBQW9CO1FBQ3JGLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3pELENBQUM7dUdBN0JvQixjQUFjOzJGQUFkLGNBQWM7O1NBQWQsY0FBYzsyRkFBZCxjQUFjO2tCQURuQyxTQUFTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtEaXJlY3RpdmV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtESVByb3h5Q29udHJvbEdldFZhbHVlLCBESVByb3h5Q29udHJvbFNldFZhbHVlfSBmcm9tICdkaS1jb250cm9scy90eXBlcyc7XG5pbXBvcnQge0RJQ29udHJvbCwgRElDb250cm9sQ29uZmlnfSBmcm9tICcuL2NvbnRyb2wnO1xuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gZm9yIHRoZSBgRElQcm94eUNvbnRyb2xgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIERJUHJveHlDb250cm9sQ29uZmlnPFRNb2RlbCwgVENoaWxkTW9kZWw+IGV4dGVuZHMgRElDb250cm9sQ29uZmlnPFRNb2RlbCwgVENoaWxkTW9kZWw+IHtcblx0LyoqXG5cdCAqIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGdldCB2YWx1ZSBmcm9tIHRoZSBjdXJyZW50IG9iamVjdCBtb2RlbCBhbmQgc2V0IGl0IHRvIHRoZSBjaGlsZCBjb250cm9sXG5cdCAqIHdoZW4gdXBkYXRlIGlzIHJlcXVlc3RlZC5cblx0ICovXG5cdGdldFZhbHVlOiBESVByb3h5Q29udHJvbEdldFZhbHVlPFRNb2RlbCwgVENoaWxkTW9kZWw+O1xuXHQvKipcblx0ICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIHVzZWQgdG8gc2V0IHZhbHVlIHRvIHRoZSBvYmplY3QgbW9kZWwgd2hlbiBjaGlsZCBjb250cm9sIHZhbHVlIGlzIGNoYW5nZWQuXG5cdCAqL1xuXHRzZXRWYWx1ZTogRElQcm94eUNvbnRyb2xTZXRWYWx1ZTxUTW9kZWwsIFRDaGlsZE1vZGVsPjtcbn1cblxuLyoqXG4gKiBgRElQcm94eUNvbnRyb2xgIGlzIHZlcnkgc3VpdGFibGUuXG4gKiBJdCBpcyB0eXBpY2FsbHkgdXNlZCBhcyBhIGhvc3QgYW5kIHdvcmtzIGV4Y2x1c2l2ZWx5IHdpdGggb2JqZWN0cy4gSXQgaXNcbiAqIG5lY2Vzc2FyeSB0byBiaW5kIGNoaWxkIGNvbnRyb2xzIHRvIGEgc3BlY2lmaWMgcHJvcGVydHkgb2YgdGhlIG9iamVjdCxcbiAqIHRoZXJlYnkgZW5zdXJpbmcgdGhhdCB0aGV5IHVwZGF0ZSBvbmx5IHRoYXQgc3BlY2lmaWMgcHJvcGVydHkgYW5kIG5vdCB0aGVcbiAqIGVudGlyZSBvYmplY3QgYXMgYSB3aG9sZS4gUGxlYXNlIHNlZSBgKkRhdGVSYW5nZVBhZ2VgLlxuICpcbiAqICMjIENyZWF0aW5nIGEgY29udHJvbFxuICogVG8gY3JlYXRlIGEgY29udHJvbCB5b3UgbmVlZCB0byBleHRlbmQgeW91ciBgQENvbXBvbmVudGAgb3IgYEBEaXJlY3RpdmVgIGZyb20gYERJUHJveHlDb250cm9sYCBjbGFzc1xuICogYW5kIHByb3ZpZGUgYGdldFZhbHVlYCBhbmQgYHNldFZhbHVlYCBmdW5jdGlvbnMgdGhhdCB3aWxsIGJlIHVzZWQgdG8gZ2V0IGFuZCBzZXQgdmFsdWUgZnJvbSB0aGUgb2JqZWN0XG4gKiB0byB0aGUgY2hpbGQgY29udHJvbC5cbiAqXG4gKiBgYGB0cyBmaWxlTmFtZT1cImN1c3RvbS1jb250cm9sLmNvbXBvbmVudC50c1wiXG4gKiBAQ29tcG9uZW50KHt9KVxuICogZXhwb3J0IGNsYXNzIEN1c3RvbUNvbnRyb2xDb21wb25lbnQgZXh0ZW5kcyBESVByb3h5Q29udHJvbDxNeU9iamVjdD4ge1xuICogICBjb25zdHJ1Y3RvcigpIHtcbiAqICAgIHN1cGVyKHtcbiAqICAgICAgZ2V0VmFsdWU6IChtb2RlbCkgPT4gbW9kZWwub2JqZWN0UHJvcGVydHksXG4gKiAgICAgIHNldFZhbHVlOiAobW9kZWwsIHZhbHVlKSA9PiAoey4uLm1vZGVsLCBvYmplY3RQcm9wZXJ0eTogdmFsdWV9KSxcbiAqICAgIH0pO1xuICogIH1cbiAqIH1cbiAqICBgYGBcbiAqXG4gKiAjIyBSZWdpc3RlcmluZyBhcyBhIGhvc3RcbiAqIEJ5IGRlZmF1bHQgeW91ciBjb250cm9sIGNhbiB3b3JrIG9ubHkgd2l0aCBgTmdNb2RlbGAgYW5kIGBGb3JtQ29udHJvbGAuIEJ1dCB5b3UgY2FuIHJlZ2lzdGVyIHlvdXIgY29udHJvbCBhcyBhIGhvc3RcbiAqIGZvciBhbm90aGVyIGNvbnRyb2xzLCB0aGVuIHlvdXIgY29udHJvbCB3aWxsIGJlIGFibGUgdG8gdXBkYXRlIHRoZW0gYW5kIGFjY2VwdCB1cGRhdGVzIGZyb20gdGhlbS4gVG8gZG8gdGhhdCB5b3UgbmVlZCB0b1xuICogdXNlIGBwcm92aWRlSG9zdENvbnRyb2xgIGZ1bmN0aW9uLlxuICpcbiAqIGBgYHRzIHsyfSBmaWxlTmFtZT1cImN1c3RvbS1jb250cm9sLmNvbXBvbmVudC50c1wiXG4gKiBAQ29tcG9uZW50KHtcbiAqICAgcHJvdmlkZXJzOiBbcHJvdmlkZUhvc3RDb250cm9sKEN1c3RvbUNvbnRyb2xDb21wb25lbnQpXSxcbiAqIH0pXG4gKiBleHBvcnQgY2xhc3MgQ3VzdG9tQ29udHJvbENvbXBvbmVudCBleHRlbmRzIERJUHJveHlDb250cm9sPE15T2JqZWN0PiB7XG4gKiAgIGNvbnN0cnVjdG9yKCkge1xuICogICAgIHN1cGVyKHtcbiAqICAgICAgZ2V0VmFsdWU6IChtb2RlbCkgPT4gbW9kZWwub2JqZWN0UHJvcGVydHksXG4gKiAgICAgIHNldFZhbHVlOiAobW9kZWwsIHZhbHVlKSA9PiAoey4uLm1vZGVsLCBvYmplY3RQcm9wZXJ0eTogdmFsdWV9KSxcbiAqICAgIH0pO1xuICogICB9XG4gKiB9XG4gKiBgYGBcbiAqXG4gKiAjIyBJbmplY3RpbmcgaG9zdCBjb250cm9sXG4gKiBCeSBkZWZhdWx0IHlvdXIgY29udHJvbCBkb2Vzbid0IGNvbW11bmljYXRlIHdpdGggaG9zdCBjb250cm9scy4gQnV0IHlvdSBjYW4gaW5qZWN0IGhvc3QgY29udHJvbCBhbmQgcHV0IGl0XG4gKiBpbnRvIGBzdXBlcmAgY2FsbC4gVGhpcyB3aWxsIHJlZ2lzdGVyIHlvdXIgY29udHJvbCBpbiB0aGUgaG9zdCBjb250cm9sIGFuZCBzdGFydCBjb21tdW5pY2F0aW9uIGJldHdlZW4gdGhlbS5cbiAqXG4gKiA+ICoqTm90ZSoqXG4gKiA+IElmIHlvdSByZWdpc3RlciB5b3VyIGNvbnRyb2wgYXMgYSBob3N0IGZvciBhbm90aGVyIGNvbnRyb2xzLCB0aGVuIHlvdSBjYW4gaW5qZWN0IGl0XG4gKiA+IG9ubHkgd2l0aCBgc2tpcFNlbGZgIG9wdGlvbi5cbiAqXG4gKiBgYGB0cyB7NX0gZmlsZU5hbWU9XCJjdXN0b20tY29udHJvbC5jb21wb25lbnQudHNcIlxuICogQENvbXBvbmVudCh7fSlcbiAqIGV4cG9ydCBjbGFzcyBDdXN0b21Db250cm9sQ29tcG9uZW50IGV4dGVuZHMgRElQcm94eUNvbnRyb2w8TXlPYmplY3Q+IHtcbiAqICAgY29uc3RydWN0b3IoKSB7XG4gKiAgICAgLy8gd2UgYWRkIGBvcHRpb25hbGAgb3B0aW9uIHRvIG1ha2UgaXQgcG9zc2libGUgdG8gdXNlIHRoaXMgY29udHJvbCB3aXRob3V0IGhvc3RcbiAqICAgICBzdXBlcih7XG4gKiAgICAgICBob3N0OiBpbmplY3RIb3N0Q29udHJvbCh7b3B0aW9uYWw6IHRydWV9KSxcbiAqICAgICAgIGdldFZhbHVlOiAobW9kZWwpID0+IG1vZGVsLm9iamVjdFByb3BlcnR5LFxuICogICAgICAgc2V0VmFsdWU6IChtb2RlbCwgdmFsdWUpID0+ICh7Li4ubW9kZWwsIG9iamVjdFByb3BlcnR5OiB2YWx1ZX0pLFxuICogICAgIH0pO1xuICogICB9XG4gKiB9XG4gKiBgYGBcbiAqXG4gKiAjIyBHZXR0aW5nIG1vZGVsXG4gKiBUbyBnZXQgbW9kZWwgeW91IG5lZWQgdG8gdXNlIGBtb2RlbGAgcHJvcGVydHkuIEl0IHdpbGwgcmV0dXJuIG1vZGVsIGZvciB0aGUgY3VycmVudCBjb250cm9sLlxuICpcbiAqIGBgYHRzIHs5fSBmaWxlTmFtZT1cImN1c3RvbS1jb250cm9sLmNvbXBvbmVudC50c1wiXG4gKiBAQ29tcG9uZW50KHt9KVxuICogZXhwb3J0IGNsYXNzIEN1c3RvbUNvbnRyb2xDb21wb25lbnQgZXh0ZW5kcyBESVByb3h5Q29udHJvbDxNeU9iamVjdD4ge1xuICogICBjb25zdHJ1Y3RvcigpIHtcbiAqICAgICBzdXBlcihcbiAqICAgICAgIGdldFZhbHVlOiAobW9kZWwpID0+IG1vZGVsLm9iamVjdFByb3BlcnR5LFxuICogICAgICAgc2V0VmFsdWU6IChtb2RlbCwgdmFsdWUpID0+ICh7Li4ubW9kZWwsIG9iamVjdFByb3BlcnR5OiB2YWx1ZX0pLFxuICogICAgICk7XG4gKiAgIH1cbiAqXG4gKiAgIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJylcbiAqICAgb25DbGljaygpIHtcbiAqICAgICBjb25zb2xlLmxvZyh0aGlzLm1vZGVsKCkpO1xuICogICB9XG4gKiB9XG4gKiBgYGBcbiAqXG4gKiAjIyBVcGRhdGluZyBtb2RlbFxuICogVG8gdXBkYXRlIG1vZGVsIHlvdSBuZWVkIHRvIGNhbGwgYHVwZGF0ZU1vZGVsYCBtZXRob2QuIEl0IHdpbGwgdXBkYXRlIG1vZGVsIGZvciB0aGUgY3VycmVudCBjb250cm9sIGFuZCBhbGxcbiAqIGNoaWxkcmVuIGNvbnRyb2xzLCBhcyB3ZWxsIGFzIGZvciB0aGUgYE5nTW9kZWxgIG9yIGBGb3JtQ29udHJvbGAuXG4gKlxuICogYGBgdHMgezl9IGZpbGVOYW1lPVwiY3VzdG9tLWNvbnRyb2wuY29tcG9uZW50LnRzXCJcbiAqIEBDb21wb25lbnQoe30pXG4gKiBleHBvcnQgY2xhc3MgQ3VzdG9tQ29udHJvbENvbXBvbmVudCBleHRlbmRzIERJUHJveHlDb250cm9sPE15T2JqZWN0PiB7XG4gKiAgIGNvbnN0cnVjdG9yKCkge1xuICogICAgIHN1cGVyKFxuICogICAgICAgZ2V0VmFsdWU6IChtb2RlbCkgPT4gbW9kZWwub2JqZWN0UHJvcGVydHksXG4gKiAgICAgICBzZXRWYWx1ZTogKG1vZGVsLCB2YWx1ZSkgPT4gKHsuLi5tb2RlbCwgb2JqZWN0UHJvcGVydHk6IHZhbHVlfSksXG4gKiAgICAgKTtcbiAqICAgfVxuICpcbiAqICAgQEhvc3RMaXN0ZW5lcignY2xpY2snKVxuICogICBvbkNsaWNrKCkge1xuICogICAgIHRoaXMudXBkYXRlTW9kZWwoe29iamVjdFByb3BlcnR5OiAnbmV3IHZhbHVlJ30pO1xuICogICB9XG4gKiB9XG4gKiBgYGBcbiAqICMjIENhdGNoaW5nIHVwZGF0ZXNcbiAqIFNvbWV0aW1lcyB5b3UgbWF5IG5lZWQgdG8gY2F0Y2ggdXBkYXRlcyBmcm9tIGRpZmZlcmVudCBzb3VyY2VzLiBGb3IgZXhhbXBsZSwgdG8gdXBkYXRlIHRoZSB2YWx1ZSBvZiB0aGUgbmF0aXZlXG4gKiBpbnB1dCBlbGVtZW50LiBUbyBkbyB0aGlzLCB5b3UgY2FuIHByb3ZpZGUgdGhlIGBvbkluY29taW5nVXBkYXRlYCBob29rLlxuICpcbiAqIGBgYHRzIHs2fSBmaWxlTmFtZT1cImN1c3RvbS1jb250cm9sLmNvbXBvbmVudC50c1wiXG4gKiBAQ29tcG9uZW50KHt9KVxuICogZXhwb3J0IGNsYXNzIEN1c3RvbUNvbnRyb2xDb21wb25lbnQgZXh0ZW5kcyBESVByb3h5Q29udHJvbDxNeU9iamVjdD4ge1xuICogICBjb25zdHJ1Y3RvcigpIHtcbiAqICAgICBzdXBlcih7XG4gKiAgICAgICBvbkluY29taW5nVXBkYXRlOiAodmFsdWU6IE15T2JqZWN0IHwgbnVsbCkgPT4ge1xuICogICAgICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC52YWx1ZSA9IHZhbHVlO1xuICogICAgICAgfSxcbiAqICAgICB9KTtcbiAqICAgfVxuICogfVxuICogYGBgXG4gKi9cbkBEaXJlY3RpdmUoKVxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIERJUHJveHlDb250cm9sPFRNb2RlbCwgVENoaWxkTW9kZWw+IGV4dGVuZHMgRElDb250cm9sPFRNb2RlbCwgVENoaWxkTW9kZWw+IHtcblx0cHJvdGVjdGVkIGNvbnN0cnVjdG9yKFxuXHRcdHByb3RlY3RlZCBvdmVycmlkZSBjb25maWc6IERJUHJveHlDb250cm9sQ29uZmlnPFRNb2RlbCwgVENoaWxkTW9kZWw+LFxuXHQpIHtcblx0XHRzdXBlcihjb25maWcpO1xuXHR9XG5cblx0b3ZlcnJpZGUgcmVnaXN0ZXJDb250cm9sKGNvbnRyb2w6IERJQ29udHJvbDxUQ2hpbGRNb2RlbD4pOiB2b2lkIHtcblx0XHR0aGlzLmNoaWxkcmVuLmFkZChjb250cm9sKTtcblxuXHRcdC8qXG5cdFx0ICogV2UgaGF2ZSB0byB1cGRhdGUgY29udHJvbCBiZWNhdXNlIGl0cyBjYW4gYmUgY3JlYXRlZCBkeW5hbWljYWxseS5cblx0XHQgKiBXZSB1c2UgUHJvbWlzZS5yZXNvbHZlIGJlY2F1c2UgTmdNb2RlbCB1c2VzIGl0IHRvbyB0byBzZXQgZmlyc3QgdmFsdWUgKGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIvYmxvYi83ZGY5MTI3MDg4YmRhM2M5ZDI5OTM3YTA0Mjg3Yjg3ZGMyMDQ1ZWE3L3BhY2thZ2VzL2Zvcm1zL3NyYy9kaXJlY3RpdmVzL25nX21vZGVsLnRzI0wzMTQpXG5cdFx0ICogc28gdGhlcmUncyBubyBuZWVkIHRvIHVzZSBhbmd1bGFyIGxpZmUgY3ljbGUgaG9va3Ncblx0XHQgKi9cblx0XHRQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpID0+IGNvbnRyb2wud3JpdGVWYWx1ZUZyb21Ib3N0KHRoaXMuY29uZmlnLmdldFZhbHVlKHRoaXMubW9kZWwoKSkpKTtcblxuXHRcdGNvbnRyb2wucmVnaXN0ZXJPbkNvbnRyb2xDaGFuZ2UoKHZhbHVlOiBUQ2hpbGRNb2RlbCB8IG51bGwpID0+IHtcblx0XHRcdHRoaXMudXBkYXRlRnJvbSA9IGNvbnRyb2w7XG5cdFx0XHR0aGlzLnVwZGF0ZU1vZGVsKHRoaXMuY29uZmlnLnNldFZhbHVlKHRoaXMubW9kZWwoKSwgdmFsdWUpKTtcblx0XHR9KTtcblxuXHRcdGNvbnRyb2wucmVnaXN0ZXJSZXF1ZXN0Rm9yVXBkYXRlKCgpID0+IHtcblx0XHRcdGNvbnRyb2wud3JpdGVWYWx1ZUZyb21Ib3N0KHRoaXMuY29uZmlnLmdldFZhbHVlKHRoaXMubW9kZWwoKSkpO1xuXHRcdH0pO1xuXHR9XG5cblx0cHJvdGVjdGVkIG92ZXJyaWRlIHVwZGF0ZUNvbnRyb2woY29udHJvbDogRElDb250cm9sPFRDaGlsZE1vZGVsPiwgdmFsdWU6IFRNb2RlbCB8IG51bGwpOiB2b2lkIHtcblx0XHRjb250cm9sLndyaXRlVmFsdWVGcm9tSG9zdCh0aGlzLmNvbmZpZy5nZXRWYWx1ZSh2YWx1ZSkpO1xuXHR9XG59XG4iXX0=